// shadow-book cdn ver 1.0.4
window.W||(window.W=new Array,W.$modules=[]),W.$modules.push(function(t,e,a){function i(){var t=window.location.pathname||"untitled";"/"==t.slice(-1)&&(t+="index.html"),this.canSave=!!window.localStorage,this.bookPath=t,this.bookId=function(t){var e,a,i=0;if(0==t.length)return i;for(e=0,a=t.length;e<a;e++)i=(i<<5)-i+t.charCodeAt(e),i|=0;return i}(t)+"",this.config={}}function o(t,e){function a(t,e){u.ajax({type:"GET",url:e,timeout:3e4,dataType:"json",success:function(e,a,i){if(Array.isArray(e)&&e.length>=1){var o=e[0];if("object"!=typeof o||Array.isArray(o))o={};else if(e.shift(),o.title&&(document.title=o.title+""),"number"==typeof o.navPanelWidth&&(t.duals.width=o.navPanelWidth),o.ctrlPanelLib){var n=document.createElement("script");n.setAttribute("type","text/javascript"),n.setAttribute("src",o.ctrlPanelLib+""),document.body.appendChild(n)}m.clearBefore(Math.floor((new Date).valueOf()/1e3)-24*(o.storageExpiredDays||250)*3600),m.loadItems(),e.forEach(function(t,e){var a=t[1];a&&m.getItem(a)&&t.push("done")}),t.duals.data=e}},error:function(t,e){console.log("warning: query book summary failed ("+(e||"unknown error")+")")}})}t<=2&&1==t&&this.defineDual("json",function(t,e){t&&a(this,t)})}function n(t){for(var e=t.target,a=null;e;){if("LI"==e.nodeName){a=e;break}e=e.parentNode}if(a){var i=a.dataset.idx||"";i&&(this.duals.goTo=[i,c.time()])}}function s(t,e){function a(t,e,a,i){var o=a.previousElementSibling,n="";o&&"LI"==o.nodeName&&(n=o.dataset.idx||"");var s=a.nextElementSibling,l="";s&&"LI"==s.nodeName&&(l=s.dataset.idx||"");var r=a.dataset.idx||"",d=a.dataset.url;if(d){if(r){var h=Math.floor((new Date).valueOf()/1e3);m.setItem(r,h)}var f,g=t.state.data,p=u.keyOfNode(a),v=parseInt(p);!isNaN(v)&&(f=g[v])&&((f=f.slice(0)).indexOf("done")<0&&f.push("done"),g=c.update(g,{$splice:[[v,1,f]]})),t.state.currIndex=r,t.componentOf("//").duals.data=g,t.duals.jumpTo=[n,l,r,d,i||"",a.textContent]}}if(t<=2)if(1==t){g=this,this.state.currIndex="",this.defineDual("jumpTo",function(t,e){});var i=!0;this.defineDual("goTo",function(t,e){var o=null,n=this.getHtmlNode();if(n){var s=t[0],l="",r=s.indexOf("!");r>=0&&(l=s.slice(r+1).trim(),s=s.slice(0,r));try{o=s?n.querySelector('li[data-idx="'+s+'"]'):n.querySelector("li[data-idx]")}catch(t){}o&&(a(this,n,o,l),i&&o.scrollIntoView(!1))}},["",0]),window.onhashchange=function(t){return function(){var e=window.location.hash;e=e&&"#"==e[0]?decodeURIComponent(e.slice(1)):"",t.duals.goTo=[e,c.time()]}}(this),this.listen("data",function(t,e){t&&(e&&0!=e.length||(window.onhashchange(),setTimeout(function(){i=!1},300)))})}else 0==t&&(g=null);else{var o=[],n=this.state.data,s=this.state.currIndex;n.forEach(function(t,e){for(var a,i=[],n=t[0]||0,l=t[1]||"",r=t[2]||"",d=t[3]||"",h=4;a=t[h];h++)"string"==typeof a&&i.push(a);l&&l===s&&i.push("active");var c={key:e+"","data-url":d,"data-idx":l};i.length&&(c.klass=i.join(" ")),n<0?(c.style={display:"none"},c.margin=[6,0,6,0]):c.margin=[6,0,6,10*n];var f=[["Li",c]],m="0"==l||0==l.indexOf("0.")?"":l;f.push(["Span",{key:"0",klass:"summary_id","html.":m}]),f.push(["Span",{key:"1","html.":r}]),o.push(u.loadElement(f))}),u.setChildren(this,o)}}function l(t,e){t<=2&&(1==t?(this.defineDual("jumpTo",function(t,e){if(t.length>=5){var a=t[0],i=t[1],o=t[2];p&&(p.duals.klass=a?"book_to_prev":"",p.duals["data-id"]=a),v&&(v.duals.klass=i?"book_to_next":"",v.duals["data-id"]=i);var n=t[3],s=t[4];if(n){if(d.__debug__)return void console.log("open md:",n);u.ajax({type:"GET",url:n,timeout:3e4,dataType:"text",success:function(t,e,a){A&&(A.duals["html."]=t);var i="#"+encodeURIComponent(o);s&&(i+="!"+s,setTimeout(function(){try{var t=document.querySelector('a[name="'+s+'"]');t&&t.scrollIntoView(!0)}catch(t){}},300)),window.location.hash!=i&&window.history.pushState(null,"section: "+o,i)},error:function(t,e){console.log("warning: query md file failed ("+n+")")}})}}},[]),this.defineDual("summaryPath",function(t,e){if(e){a=".list"===e.slice(-5)?e:e+".list";(i=this.componentOf(a))&&i.unlisten("*",this)}if(t){var a=".list"===t.slice(-5)?t:t+".list",i=this.componentOf(a);i?i.listen("jumpTo",this,"jumpTo"):console.log("error: can not locate component ("+a+")")}})):2==t?(p=this.componentOf("prev"),v=this.componentOf("next"),A=this.componentOf("mark")):0==t&&(p=null,v=null,A=null))}function r(t,e){function a(t){var e=A&&A.getHtmlNode();e&&(e.scrollTop=0,e.scrollLeft=0)}if(1==e){var i=["Img",{key:"img",style:{width:"100%",height:"100%",backgroundColor:"rgba(0,0,0,0.04)"},src:this.state["data-src"]||"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAAn1BMVEUAAAD///////////////////////////////8AAAAHBwcICAgJCQkLCwsMDAwdHR05OTk6Ojo7Ozs8PDw9PT0+Pj4/Pz9DQ0NERERFRUVGRkZISEhJSUlMTExNTU1/f3+UlJSXl5ecnJyfn5+3t7e4uLi5ubnBwcHCwsLDw8PExMTx8fHy8vLz8/P09PT19fX29vb4+Pj5+fn6+vr////GdZrgAAAACXRSTlMATU7i5OXm5/HEWyOWAAAAAWJLR0Q0qbHp/QAAAN9JREFUOMvVkckSgjAQRImKJm6I+44Lirug/f/f5sSKqQihLG/aB2CmX8gk7Th/okIRVhWZAlzkqKQAYN23aA1oIBAWBd8AH7YoG3MliVG4r2NWdOsyGl91UWGp6+A4toTwT+DMel0cJ18Ol0NoP4cgPx6QWa3SYxhnCLm+TVYzihr0ap9TBPnnztMHoiZ9dN4J7e/k6bKE9LvK5xzYSaJrEC5uE2rVQvIZ0QhrVE7vRtwL6W/wXKOJpRHWTIj6FuqfktgQMTeAldc/QO8piX3PW6XTfJvakqaZXbbz23oAhlQ3P/v7RVUAAAAASUVORK5CYII=",$onClick:a}];u.setChildren(this,[u.loadElement(i)]),this.componentOf(".body").listen("innerSize",function(t,e){this.reRender()}.bind(this))}if(t<=2)1==t&&this.defineDual("data-src",function(t,e){if(t){var a=this.componentOf("img");a&&a.isHooked&&(a.duals.src=t)}});else{var o=this.componentOf(".body").duals.innerSize;this.state.left=o[0]-this.state.width-(parseInt(this.state["data-right"])||4),this.state.top=o[1]-this.state.height-(parseInt(this.state["data-bottom"])||4)}}t("react"),t("react-dom");var d=t("shadow-widget"),h=d.$main,u=d.$utils,c=d.$ex,f=(d.$idSetter,"rewgt/shadow-book/");i.prototype={clearBefore:function(t){if(this.canSave){var e=localStorage.getItem(f+"books");if(e){e=JSON.parse(e);var a=[];for(var i in e){var o=localStorage.getItem(f+i);if(o){o=JSON.parse(o);var n=0,s=[];for(var l in o)n+=1,o[l]<t&&s.push(l);n==s.length?(localStorage.removeItem(f+i),a.push(i)):s.length&&(s.forEach(function(t){delete o[t]}),localStorage.setItem(f+i,JSON.stringify(o)))}}a.length&&(a.forEach(function(t){delete e[t]}),localStorage.setItem(f+"books",JSON.stringify(e)))}}},loadItems:function(){if(this.config={},this.canSave){var t=JSON.parse(localStorage.getItem(f+"books")||"{}");t[this.bookId]||(t[this.bookId]=this.bookPath,localStorage.setItem(f+"books",JSON.stringify(t))),this.config=JSON.parse(localStorage.getItem(f+this.bookId)||"{}")}},setItem:function(t,e){this.config[t]=e,this.canSave&&localStorage.setItem(f+this.bookId,JSON.stringify(this.config))},getItem:function(t){return this.config[t]}};var m=new i,g=null,p=null,v=null,A=null,k=null;h.$$onLoad.push(function(t){function e(t){if(!d.__design__){var e=t.target.getAttribute("data-id");e&&g&&(g.duals.goTo=[e,c.time()])}}u.setVendorLib("rewgt",function(a){if(!k){var i=u.loadElement([["Panel",{key:"book_summary",width:240,klass:"auto-hidden-visible default-large-small",style:{backgroundColor:"#fafafa"},json:"","dual-data":[],$id__:o}],["Ul",{key:"list",width:.9999,padding:[0,0,12,4],klass:"default-square-circle default-large-small auto-hidden-visible book_summary",style:{color:"#444"},$data:"duals.data",$onClick:n,$id__:s}]]),d=u.loadElement([["Panel",{key:"book_content",summaryPath:"",$id__:l}],["Panel",{key:"prev","data-id":"",width:36,height:.9999,$onClick:e}],["MarkedDiv",{key:"mark",width:-1,height:.9999,style:{overflow:"auto"}}],["Panel",{key:"next","data-id":"",width:36,height:.9999,$onClick:e}]]),h=u.loadElement([["Div",{key:"book_top",width:0,height:0,"data-width":"32","data-height":"32","data-right":"4","data-bottom":"4","data-src":"","data-title":""}],["P",{key:"p",margin:[0,0,0,0],$id__:r,$title:'duals["data-title"]',$width:'ex.parseInt(duals["data-width"])',$height:'ex.parseInt(duals["data-height"])',"$data-right":'duals["data-right"]',"$data-bottom":'duals["data-bottom"]',"$data-src":'duals["data-src"]',style:{position:"absolute",zIndex:"999"}}]]);k=[i,d,h]}a.setChild(k[0],k[1],k[2],t)})})});