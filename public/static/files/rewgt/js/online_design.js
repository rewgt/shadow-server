!function(){function e(e,t){var e=e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");return t&&(e=e.replace(/"/g,"&quot;")),e}function t(e){var t=document.createElement("a");return t.href=e,""==t.host&&(t.href=t.href),t}function n(e){var t={};return e.split("&").forEach(function(e){if(e){var n=e.split("="),i=n[0].trim();i&&(t[i]=(n[1]||"").trim())}}),t}function i(e,t){var n=null;window.XMLHttpRequest?n=new XMLHttpRequest:window.ActiveXObject&&(n=new ActiveXObject("Microsoft.XMLHTTP")),n&&(n.onreadystatechange=function(){4==n.readyState&&(200==n.status?t(null,n.responseText):t(new Error("XMLHttpRequest failed")),n=null)},n.open("GET",e,!0),n.send(null))}function o(e,t,n){var i=null;if(window.XMLHttpRequest?i=new XMLHttpRequest:window.ActiveXObject&&(i=new ActiveXObject("Microsoft.XMLHTTP")),i){var o=JSON.stringify(t);i.onreadystatechange=function(){4==i.readyState&&(200==i.status?n(null,i.responseText):n(new Error("XMLHttpRequest failed")),i=null)},i.open("POST",e,!0),i.setRequestHeader("Content-Type","application/json; charset=utf-8"),i.send(o)}}function r(e,t){if(!e.types)return!1;var n,i=e.types.length;for(n=0;n<i;n+=1)if(e.types[n]==t)return!0;return!1}function a(e){e.stopPropagation()}function l(e){e.stopPropagation(),e.preventDefault()}function s(){return He&&"none"!=He.style.display}function d(e){var t;if(e&&(t=at(e))){var n=e.getAttribute("data-rewgt-owner");return n?n+"."+t:t}return""}function p(e){var t=e.split("/");if(t.length<=2)return null;for(var n,i=t.shift(),o="";n=t.shift();){if("$"!=n[0]||"$"!=n[1]){o+="/"+n;break}o+="/"+n}var r=t.join("/");return r?[i,o,r]:null}function u(e,t){var n=Array.isArray(e)?e:p(e+"");if(n){var o=n[0]+n[1];if(!it.hasOwnProperty(o)){var r,a=o+"/"+n[2];i(r=ot.isGithub?n[1]+"/TOOL.json":"/app/"+o+"/web/TOOL.json",function(e,n){if(e)console.log("error: read file failed ("+r+")");else try{var i=JSON.parse(n);it[o]=!1;var l={},s=[];Object.keys(i).forEach(function(e){var t=i[e];t&&Array.isArray(t.tools)&&(t.hasOwnProperty("baseUrl")?(t.tools.forEach(function(e){e.baseUrl=t.baseUrl}),l[e]=t):(t.name=e,s.push(t)))}),s.forEach(function(e){var n=e.opt||"mono/all",i=[],o=!1;if(e.tools.forEach(function(e){if("string"==typeof e)if("*"!=e){var t=e.split("/"),n=t.pop(),r=t.join("/"),a=n&&l[r];if(a&&Array.isArray(a.tools)){var s=a.tools.find(function(e){return e.name===n});s&&i.push(s)}}else o=!0}),it[e.name]=[n,i,o],a==e.name&&t){var r=n.split("/");t[0]=r[0],t[1]=r[1]||"all"}})}catch(e){console.log(e),ue.instantShow("error: parse JSON failed ("+r+").")}})}}}function c(e){for(var t=Ze.length-1;t>=0;t-=1)if(Ze[t][0]===e){Ze.splice(t,1);break}}function f(){var e="";if(ze&&ze.parentNode){var t=q(ze);t&&(e=t[0])}return{viewportX:se,viewportY:de,viewportWd:pe,topPanelHi:ue.frameInfo.topHi,rightPanelWd:ue.frameInfo.rightWd,rootKeyid:Fe,showPages:"none"!=we.style.display,selected:e}}function h(){if(!Qe)return[];try{var e=localStorage.getItem("rewgt/design-bakIndex")||"[]";return JSON.parse(e)}catch(e){return[]}}function g(){for(var e,t=h(),n=[];e=t[1];)n.push(e[0]),t.splice(1,1);if(n.length)try{n.forEach(function(e){localStorage.removeItem("rewgt/design-bak_"+e)}),localStorage.setItem("rewgt/design-bakIndex",JSON.stringify(t))}catch(e){}}function v(e,t){var n=t.length,i=Math.min(64,Math.max(3,parseInt(Xe.cacheSize)||5)),o=1048576*(i-=1);if(n>o)ue.instantShow("error: write backup failed (document size should less than "+i+"M).");else{var r=h(),a=-1;nt&&((a=r.findIndex(function(e){return e[0]==nt}))>=0&&a<r.length-1?a+=1:a=-1);var l=0;r.forEach(function(e,t){(a<0||t<a)&&(l+=e[1])}),l+=n;for(var s=[];l>o&&r.length;){d=r.shift();s.push(d[0]),l-=d[1]}a-=s.length;try{if(a>=0)for(var d=r[a];d;)s.push(d[0]),r.splice(a,1),d=r[a];r.push([e,n]),s.forEach(function(e){localStorage.removeItem("rewgt/design-bak_"+e)}),localStorage.setItem("rewgt/design-bak_"+e,t),localStorage.setItem("rewgt/design-bakIndex",JSON.stringify(r)),nt=0}catch(e){ue.instantShow("error: save backup to local storage failed."),console.log("write local storage failed, it's size should large than 5M.")}}}function m(e){try{return localStorage.getItem("rewgt/design-bak_"+e)}catch(e){return null}}function y(){if(!lt&&ue.dumpTree){var e=[];if(ue.dumpTree(e),1==e.length){lt=!0;var t=(new Date).valueOf()-1e3;v(t,JSON.stringify({id:t,state:f(),doc:e[0]}))}}}function b(e){function t(){tt=setTimeout(function(){if(tt=0,n+=1,Ze.length)if(n>=4){var i=Ze[0][1];ue.instantShow("hint: can not save backup when system not in idle"+(i?" (still in "+i+")":"")+".")}else e=1e3,t();else{var o=[];if(ue.dumpTree(o),1==o.length){var r=(new Date).valueOf();v(r,JSON.stringify({id:r,state:f(),doc:o[0]}))}}},e)}if(Qe&&ue.dumpTree){tt&&(clearTimeout(tt),tt=0);var n=0;"number"!=typeof e&&(e=3e3),t()}}function x(e){if(!Qe)return!1;if(Ze.length){var t=Ze[0][1];return ue.instantShow("warning: task ("+e+") ignored when system not in idle"+(t?" (still in "+t+").":".")),!1}return!tt||(ue.instantShow("warning: task ("+e+") ignored when pending backup not finished."),!1)}function w(){if(x("undo")){var e=-1,t=h();nt?(e=t.findIndex(function(e){return e[0]==nt}))>=0&&(e-=1):e=t.length-2;var n=e>=0?t[e][0]:0;if(!n||n<et)ue.instantShow("warning: nothing to undo.");else{var i=m(n);if(!i)return void ue.instantShow("warning: load backup item from local storage failed.");A(i),nt=n}}}function k(){if(x("redo")){var e=-1,t=h();if(nt&&((e=t.findIndex(function(e){return e[0]==nt}))>=0&&e+1<t.length?e+=1:e=-1),e<0)ue.instantShow("warning: nothing to redo.");else{var n=t[e][0],i=m(n);if(!i)return void ue.instantShow("warning: load backup item from local storage failed.");A(i),nt=n}}}function A(e){function t(){F(),se=o.viewportX||0,de=o.viewportY||0,pe=o.viewportWd||0,ue.frameInfo.topHi=o.topPanelHi||0,ue.frameInfo.rightWd=o.rightPanelWd||0,ue.style.left=se+"px",ue.style.top=de+"px",ce.style.backgroundPosition=ne-14+"px "+(ue.frameInfo.topHi+de)+"px",fe.style.backgroundPosition=ne+se+"px "+(ee-28)+"px",fe.style.display=ue.frameInfo.topHi?"block":"none",he.style.display=ue.frameInfo.rightWd?"block":"none",me.style.display=0==se&&0==de?"block":"none",O(),o.showPages?(ye.style.visibility="visible",we.style.display="block"):(we.style.display="none",ye.style.visibility="hidden"),we.innerHTML="",we.style.left="0px",o.rootKeyid?P(o.rootKeyid,!1,n):(fe.listChildren(""),n())}function n(){var e=o.selected;e?ue.getWidgetNode&&ue.getWidgetNode(e,"",function(e){X(e,!1,!1)}):fe.listChildren("")}if(ue.loadTree){var i=JSON.parse(e),o=i.state,r=i.doc;ze=null,ue.loadTree(ue,r,function(){ue.topmostNode()?t():alert("Restore backup version failed!")})}}function E(e,t){"ScenePage"==Je&&C(Fe),t&&setTimeout(function(){_(t)},100),b(e)}function S(e,t){var n=t.cloneNode(!0);n.style.display="block",n.style.position="static",n.style.width="900px",n.style.height="700px",n.style.transform="scale(0.142)",n.style.transformOrigin="0 0",n.style.zIndex="3006",e.appendChild(n);var i,o=t.querySelectorAll("canvas"),r=o.length;r&&r==(i=n.querySelectorAll("canvas")).length&&setTimeout(function(){for(var e,t,n=0;e=o[n];n++)(t=i[n]).width&&t.height&&t.getContext("2d").drawImage(e,0,0)},600)}function M(e,t){var n=!1;if(t)n=!0;else{for(var i,o=0;i=e[o];o++){var r=i[0]+"",a=we.children[o];if(!a||a.getAttribute("keyid")!==r){n=!0;break}}n||e.length==we.children.length||(n=!0)}if(n){we.innerHTML="";var l=be.clientWidth||window.innerWidth-ne-80,s=Math.floor(l/oe);we.style.width=Math.max((e.length+s-1)*oe,20)+"px",e.forEach(function(e){var t=e[0]+"",n=e[1],i=n.getAttribute("name"),o=document.createElement("div");o.setAttribute("style","width:128px; height:100px; background:#fff; margin:2px 4px; float:left; overflow:hidden; outline:red dotted 0px"),o.setAttribute("keyid",t),i&&o.setAttribute("name",i),we.appendChild(o),S(o,n)})}for(var d,o=0;d=we.children[o];o++){var p=d.getAttribute("keyid")==Fe;d.style.outlineWidth=p?"1px":"0px"}}function P(e,t,n){ue.showRootPage?ue.showRootPage(e,function(i){fe.listChildren(""),Fe=(Je=i)?e:"";for(var o,r="ScenePage"==i?e:"",a=0;o=we.children[a];a++){var l=o.getAttribute("keyid")==r;o.style.outlineWidth=l?"1px":"0px"}!t||"Panel"!=i&&"Template"!=i||ue.getWidgetNode(ue.frameInfo.rootName+"."+e,"",function(e){X(e,!1,!1)}),r&&ue.getWidgetNode(ue.frameInfo.rootName+"."+e,"",function(t){t&&setTimeout(function(){var n=document.createEvent("Event");n.initEvent("slideenter",!0,!0),n.pageKey=e,t.dispatchEvent(n)},0)}),n&&n()}):n&&n()}function C(e){if(e){var t=null,n=[];ue.listChildren&&(t=ue.listChildren("")),t&&(n=t[4]);for(var i,o=null,r=0;i=n[r];r+=1)if(i[0]==e){o=i[1];break}if(o)for(var a,r=0;a=we.children[r];r++)if(a.getAttribute("keyid")==e){sName=o.getAttribute("name"),sName?a.setAttribute("name",sName):a.removeAttribute("name"),a.innerHTML="",S(a,o);break}}}function L(){var e=0==ue.frameInfo.topHi;re=Math.floor(.5*(pe||window.innerWidth-ne-(e?0:te))),ae=Math.floor(.5*(window.innerHeight-(e?0:ee)-de))}function T(){var e=0==ue.frameInfo.topHi;ge.style.top=(e?0:ee)+(ae-10)+de+"px",ve.style.left=ne+(re-10)+se+"px",me.style.left=pe?ne+pe-20+se+"px":window.innerWidth-te-20+"px"}function N(e,t){function n(e){var t=[],n={};return Object.keys(e).forEach(function(n){var i,o=e[n];if("object"==o.type)if("default"in o)i=o.default;else{if(!("properties"in o))return;i={};var r=o.properties;Object.keys(r).forEach(function(e){i[e]=r[e].default})}else i=o.default;t.push([o.propertyOrder||0,n,i])}),t.sort(function(e,t){return e[0]-t[0]}),t.forEach(function(e){n[e[1]]=e[2]}),n}var i=null,o=null,r=null;return[function(a){var l=a.props&&ue.widgetSchema(a,!1,t);return l&&2==l.length?(i=l[0],o=l[1],r=o.wdgtOption,delete o.wdgtOption,[n(o.properties||{}),e,r]):[null,e,null]},function(t,n,a){function l(t,n){var i=e;if(s&&(ze=p),t){if(n)if(n.classList.contains("rewgt-scene")){var o=d(n);J(),o&&setTimeout(function(){P(o,!1,function(){X(n,!1,!1)})},0)}else{var r=q(n),a=r?r[0]:"";a&&a==e?X(n,!1,!1):i=""}E(300,i)}}var s=!1,p=ze;if(o&&r&&i&&n[0]){var u=n[1],c=n[2];if(ue.saveWdgtProp&&"object"==typeof u&&Array.isArray(c))return s=!0,ze=null,c.forEach(function(e){u[e]=void 0}),void ue.saveWdgtProp(t,i,r,u,l)}return l(!1,null)}]}function I(e){for(var t,n=Le.querySelectorAll("img"),i=null,o=0;t=n[o];o++)t.getAttribute("extend")?Le.removeChild(t):(t.style.display="none",e&&"uplevel"==t.getAttribute("name")&&(i=t));i?(Le.style.width=ie+"px",Le.style.visibility="visible",i.style.display="inline"):(Le.style.width="0px",Le.style.visibility="hidden")}function D(e,t,n,i){for(var o,r=Le.querySelectorAll("img"),a=[],l=[],d=0;o=r[d];d++)if(o.getAttribute("extend"))Le.removeChild(o);else{var p=o.getAttribute("name");p&&e[p]?a.push(o):l.push(o)}var u=[];t&&t.forEach(function(e){if(e.clickable&&(!e.onlyScene||i)){var t,o=e.icon,r=e.baseUrl||"";t=o?"/"==o[0]||0==o.indexOf("http")&&(":"==o[4]||"s:"==o.slice(4,6))?o:r&&"/"!=r.slice(-1)?r+"/"+o:r+o:ot.appBase()+"/res/tools.png";var a=document.createElement("img");a.setAttribute("extend","true"),a.setAttribute("style","display:none; width:16px; height:16px; border:1px solid #f0f0f0; margin:2px;"),a.setAttribute("src",t),e.title&&a.setAttribute("title",e.title),a.setAttribute("draggable","false"),Le.appendChild(a),u.push(a),a.onload=function(e){e.target.style.display="inline"},a.onclick=function(t){if(!s()&&(t.stopPropagation(),ze&&ze.parentNode&&ue.popDesigner)){var i=q(ze);if(i){var o=i[0],a=Object.assign({},e);if(!a.get||!a.set){var l=N(o,n);a.get=l[0],a.set=l[1]}ue.popDesigner(o,a.name,a,r)}}}}}),l.forEach(function(e){e.style.display="none"}),Le.style.width=ie*(a.length+u.length)+2+"px",a.forEach(function(e){e.style.display="inline"})}function O(e){var t,n=window.innerWidth,i=window.innerHeight;if(!(n<ne+80+te)){t=pe?Math.max(te,n-(ne+pe+se)):te,L(),ue.frameInfo.rightWd=0==ue.frameInfo.topHi?0:t,ue.frameInfo.bottomHi=de,ue.refreshFrame&&ue.refreshFrame();var o=fe.querySelectorAll("td")[2];o&&(o.style.width=t+"px"),he.style.left=n-t+"px",he.style.width=t+"px",Ae.style.height=i-64+"px";var r=n-ne-t;ye.style.width=r+"px",be.style.width=r-80+"px",xe.style.width=r-80+"px",T(),Be.style.width=(Be.isFull?n-ne:n-ne-ue.frameInfo.rightWd)+"px"}}function H(e,t){function n(){Se.inScene=a,Se.style.borderColor=o?a?"transparent blue blue blue":"transparent red red red":a?"blue":"red",Se.style.left=Me.left+"px",Se.style.top=Me.top+"px",Se.style.width=Math.max(0,Me.width-2)+"px",Se.style.height=Math.max(0,Me.height-2)+"px",Se.style.display="block"}function i(){Pe.style.borderColor=r?"transparent blue blue blue":"blue",Pe.style.left=Ce.left+"px",Pe.style.top=Ce.top+"px",Pe.style.width=Math.max(0,Ce.width-2)+"px",Pe.style.height=Math.max(0,Ce.height-2)+"px",Pe.style.display="block"}var o=!1,r=!1,a=!1;if(e){var l,s,d,p;try{l=e.getBoundingClientRect()}catch(e){l=null}if(!l)return;(d=Math.min(0,l.top-ue.frameInfo.topHi))<0&&(o=!0,l={left:l.left,top:ue.frameInfo.topHi,width:l.width,height:l.height+d});var u=!1;if(ft.length){var c=ft[ft.length-1][2];try{s=c.getBoundingClientRect(),u=!0}catch(e){}u&&(p=Math.min(0,s.top-ue.frameInfo.topHi))<0&&(r=!0,s={left:s.left,top:ue.frameInfo.topHi,width:s.width,height:s.height+p})}var f=!1;u?f=Ce.left!=s.left||Ce.top!=s.top||Ce.width!=s.width||Ce.height!=s.height:(Pe.style.display="none",Ce={left:0,top:0,width:0,height:0});var h=(new Date).valueOf();(u&&ze!==e||f)&&(pt&&(clearTimeout(pt),pt=0),Ce=s,ze!==e&&(ut=0),h-ut>2e3?i():(Pe.style.display="none",pt=setTimeout(i,800)),ut=h);var g=!1,v=Me.left!=l.left||Me.top!=l.top||Me.width!=l.width||Me.height!=l.height;(ze!==e||v)&&(st&&(clearTimeout(st),st=0),Me=l,ze!==e&&(dt=0,ze=e,je+=1,g=!0),t?(a=3==t.length&&"ScenePage"==t[1][0],Se.isSceneWdgt=a):a=Se.isSceneWdgt,h-dt>2e3?n():(Se.style.display="none",st=setTimeout(n,800)),dt=h,g&&j(t)),!g&&t&&setTimeout(function(){Ke.select()},0)}else ze&&(Pe.style.display="none",Se.style.display="none",ze=null,Ne.innerHTML="",j(null))}function _(e){if(ze&&ze.parentNode&&ue.widgetSchema){var t=q(ze);if(t){var n=t[0],i=t[2],o=B(i);if((!e||n==e)&&o<2){var r=0!=o||B(i,!0)>0;(t=ue.widgetSchema(n,!0,r))&&Ae.setPropEditor(t[0],t[1],t[2],t[3])}}}}function B(e,t){var n=0,i=e.length-2;for(t&&(i+=1);i>=0;){var o=e[i];if(i-=1,o[3])return 2;var r=o[0];if("Template"==r||"ScenePage"==r){for(;i>=0;){var a=e[i];if(i-=1,a[3]){n=2;break}}return n}var l,s=o[2];if(s&&(l=s[1]))if("some"==l)n=1;else if("none"==l)return 2;if(t)break}return n}function z(e,t){var n=ue.getGroupOpt(t);return n&&n.tools&&(e=e.slice(0),n.tools.forEach(function(t){(t=Object.assign({},t)).baseUrl=n.baseUrl,e.push(t)})),e}function j(e){function t(){for(var e=!!ue.hideTemplate;item=ft.pop();)e&&ue.hideTemplate(item[1],!0)}if(ue.setSceneCurrent){var n=[],i=!1;if(ct.length)if(!e||e.length<=2||"ScenePage"!=e[1][0])n.push([ct[0],""]),ct=[],i=!0;else{ct[0]!=e[1][1]&&(i=!0,n.push([ct[0],""]));var o=e[1][1],r=e[2][1];ct[0]==o&&ct[1]==r||(i=!0),ct=[o,r],n.push(ct)}else e&&e.length>2&&"ScenePage"==e[1][0]&&(ct=[e[1][1],e[2][1]],i=!0,n.push(ct));n.length&&ue.setSceneCurrent(n),i&&setTimeout(function(){"ScenePage"==Je&&C(Fe)},300)}if(!ze)return t(),ht=[],Ae.setPropEditor(0,null,null),Re=!1,void(qe=!1);if(e){t(),ht=[];var a=3==e.length&&"ScenePage"==e[1][0],l=!!ue.showTemplate,s=e.length-1,d="",p=!1,u=!1;e.forEach(function(e,t){d&&(d+="."),d+=e[1];var n=e[0],i=e[2],o=e[3];o&&(ht.push(o),t==s&&(p=!0)),"Template"==n&&i&&(ft.push(i),l&&ue.showTemplate(i[1],!0),t==s&&(u=!0))}),K(d);var c=null,f=B(e),h=0,g=!1,v=!1,m=ze.getAttribute("data-group.optid");if(m){var y=it[m];y?("all"!=(y[0]||"mono/all").split("/").pop()&&(v=!0),c=y[1],g=y[2]):h=500}else f>=2&&(h=500);setTimeout(function(){var t=!1;if(h&&m&&(i=it[m])&&("all"!=(i[0]||"mono/all").split("/").pop()&&(v=!0,t=!0),c=i[1],g=i[2]),h&&f>=2&&(f=B(e)),f>=2)I(!0),Ae.setPropEditor(0,null,null);else{var n=!1;if(d&&ue.widgetSchema){t||(v=0!=f||B(e,!0)>0);var i=ue.widgetSchema(d,!0,v);i&&(n=ze&&0==ze.children.length&&i[4],Ae.setPropEditor(i[0],i[1],i[2],i[3]))}var o=e.length>=2?e[1][0]:"",r={copy:1};if(1!=f&&(r.move=1),p&&(r.linker=1,r.styles=1),n&&(r.edit_txt=1),(e.length>2||2==e.length&&("Panel"==o||"ScenePage"==o))&&(r.uplevel=1),a&&(r.copy_lnk=1,r.up=1,r.down=1),d&&ue.getGroupOpt)if(g&&c)c=z(c,d);else if(!c){var l=ue.getGroupOpt(d),s=l&&l.tools||[];c=[],s.forEach(function(e){(e=Object.assign({},e)).baseUrl=l.baseUrl,c.push(e)}),v=l&&"all"!=l.editable}D(r,c,v,a)}},h)}Re=!!ze.style.width,qe=!!ze.style.height}function R(e){for(var t,n=0;t=e[n];n++)if(t[3]&&n<e.length-1)return!0;return!1}function q(e,t){var n=ue.children[0];if(!n)return null;for(var i=[],o=[],r=!1,a=null,l="";e;){if(e===n){r=!0,t&&t.unshift(e),i.unshift(["Panel",ue.frameInfo.rootName,["mono","all"]]),l=ue.frameInfo.rootName+l,o.forEach(function(e){e[1]=ue.frameInfo.rootName+e[1]});break}var s=d(e);if(s){var p=[],c=!1;if(e.classList.contains("rewgt-panel")?p.push("Panel"):e.classList.contains("rewgt-unit")?p.push("Unit"):e.classList.contains("rewgt-inline")&&(p.push("Span"),c=!0),p.length){a||(a=e);var f=c?"data-span.path":"data-unit.path";if(e.hasAttribute(f)||(f=""),p.push(s),e.hasAttribute("data-temp.type")){h=[e.getAttribute("data-temp.type"),"",e];o.push(h),p.push(h),p[0]="Template"}else if(e.classList.contains("rewgt-scene")){var h=[e.getAttribute("name")||"","",e];o.push(h),p.push(h),p[0]="ScenePage"}else{var g=e.getAttribute("data-group.opt")||"",v=g.split("/"),m=["mono","none"],y=e.getAttribute("data-group.optid");y?(h=it[y])?(v=(g=h[0]+"").split("/"),m[0]=v[0]||"mono",m[1]=v[1]||"all"):u(y,m):(m[0]=v[0]||"mono",m[1]=v[1]||"all"),p.push(m)}if(f){var b=[e.getAttribute(f),"",e];o.push(b),p.push(b)}t&&t.unshift(e),i.unshift(p),l="."+s+l,o.forEach(function(e){e[1]="."+s+e[1]})}}e=e.parentNode}return r&&a?[l,a,i]:null}function U(){if("0px"!=Le.style.width){var e=vt+=1;Le.style.visibility="visible",gt=setTimeout(function(){e==vt&&(Le.style.visibility="hidden",gt=0)},4e3)}}function X(e,t,n){if(!e)return null;var i=q(e);if(i&&i.length>=2){if(t&&2==i.length&&"Panel"!=i[1][0])return i;var o=i[0],r=i[1],a=i[2];H(r,a),fe.setWidgetInfo(a),fe.listChildren(o),n&&U()}return i}function J(){We.style.display="none",H(null,null),fe.setWidgetInfo(null),fe.listChildren(""),Ge=0,Ke.value=""}function F(){ze=null,Je="",Fe="",ct=[],ft=[],ht=[],yt=!1,mt=0,bt=!1,Lt=!1,Wt=!1,Dt=!1,Re=!1,qe=!1,$e=null,Ye=0,We.style.display="none",Pe.style.display="none",Se.style.display="none",ue.style.zIndex="3000",Oe.style.display="none",He.style.display="none",_e.style.display="none",Ne.innerHTML="",Ie.innerHTML="",Ie.isSceneWdgt=!1}function K(e){Array.isArray(e)&&($e=null),ue.dumpWidget&&setTimeout(function(){Ge=1,ue.dumpWidget(e,function(t,n){t&&(Ye=je,$e=e,Ge=2,Ke.value=n,Ke.select())})},0)}function G(e){if(yt=!1,mt=0,!s()){var t=e.target;if("IMG"!=t.nodeName||"DIV"!=(t=t.parentNode).nodeName||"float-btn"!==t.getAttribute("name")){var n=e.clientX,i=e.clientY;if(function(e,t){if(e>ne){if(ue&&0==ue.frameInfo.topHi)return!0;if(t>ee)return!0}return!1}(n,i)){var o=document.body.style.cursor;if(ze&&o&&("ew-resize"==o?mt=1:"ns-resize"==o?mt=2:"nwse-resize"==o&&(mt=3)),Ct=!1,It=!1,Ot=!1,xt=!1,yt=!1,mt)Mt=n,Pt=i;else if(!e.shiftKey&&"ScenePage"==Je){var r=!1,a=!1;if(!ze||ze.classList.contains("rewgt-scene")||ze.getAttribute("data-is.ground")&&(a=!0)){if(a?Ct=!0:"block"==We.style.display&&We.children.length>1?!function(e,t){for(var n,i=1;n=We.children[i];i+=1){var o=n.getBoundingClientRect();if(e>=o.left&&e<o.left+o.width&&t>=o.top&&t<o.top+o.height)return!0}return!1}(n,i)?Ct=!0:(It=!0,multiWdgtMoved_=!1,_t=n,Bt=i):Ct=!0,Ct)for(Tt=n,Nt=i;We.children.length>1;)We.removeChild(We.children[1]);document.body.style.cursor="default"}else{var l=ze.getBoundingClientRect();if(n>=l.left&&n<l.left+l.width&&i>=l.top&&i<l.top+l.height)r=!0,xt=!0,St=!1,kt=n,At=i;else{for(Ct=!0,Tt=n,Nt=i;We.children.length>1;)We.removeChild(We.children[1]);document.body.style.cursor="default"}}r||e.preventDefault()}}}}}function $(e,t,n){for(var i=[e],o=1;r=We.children[o];o+=1)(a=r.getAttribute("keyid"))&&i.push(a);if(!(i.length<=1)&&ue.moveSceneWdgt){y(),i=ue.moveSceneWdgt(i,t,n);for(var r,o=1;r=We.children[o];o+=1){var a=r.getAttribute("keyid");a&&i.indexOf(a)>=0&&(t&&(r.style.left=parseFloat(r.style.left)+t+"px"),n&&(r.style.top=parseFloat(r.style.top)+n+"px"))}E(3e3,"")}}function Y(e){if(!(s()||ue.splitterMouseDn&&ue.splitterMouseDn())){var t="default",n=e.clientX,i=e.clientY;if(Ct){if(ue.selectMultWdgt){for(;We.children.length>1;)We.removeChild(We.children[1]);var o=Math.min(n,Tt),r=Math.min(i,Nt),a=Math.max(n,Tt),l=Math.max(i,Nt),d=We.children[0];d?d.style.display="block":((d=document.createElement("div")).setAttribute("style","position:absolute; border:1px dotted red; left:0px; top:0px; width:0px; height:0px;"),We.appendChild(d)),d.style.left=o+"px",d.style.top=r+"px",d.style.width=Math.max(0,a-o-2)+"px",d.style.height=Math.max(0,l-r-2)+"px",(c=ue.selectMultWdgt(Fe,Tt,Nt,n,i)).forEach(function(e){var t=e[0],n=e[1],i=e[2],o=e[3],r=e[4],a=document.createElement("div");a.setAttribute("keyid",t),a.setAttribute("style","position:absolute; border:1px dotted red; left:"+n+"px; top:"+i+"px; width:"+Math.max(0,o-2)+"px; height:"+Math.max(0,r-2)+"px;"),We.appendChild(a)}),We.style.display="block",je+=1}}else if(It&&(Ot||(Math.abs(n-_t)>=4||Math.abs(i-Bt)>=4)&&(It=!1,Ot=!0,Ht=Ve+=1,Ze.push([Ht,"moving widget"]))),Ot){h=i-Bt;0==(f=n-_t)&&0==h||(multiWdgtMoved_||(multiWdgtMoved_=!0,y()),_t=n,Bt=i,$(Fe,f,h))}else if(ze&&ze.parentNode){var p=ze.getBoundingClientRect(),u=Math.min(0,p.top-ue.frameInfo.topHi);if(u<0&&(p={left:p.left,top:ue.frameInfo.topHi,width:p.width,height:p.height+u}),n>=p.left&&n<p.left+p.width&&i>=p.top&&i<p.top+p.height&&(gt&&(clearTimeout(gt),gt=0),yt||"none"!=We.style.display||U(),n>=p.left+p.width-6?i>=p.top+p.height-6?Re?t=qe?"nwse-resize":"ew-resize":qe&&(t="ns-resize"):Re&&(t="ew-resize"):i>=p.top+p.height-6&&qe&&(t="ns-resize"),Se.inScene&&!yt&&xt&&"default"==t&&"none"!=Se.style.display&&ue.splitterMouseDn&&!ue.splitterMouseDn()&&(Math.abs(n-kt)>=4||Math.abs(i-At)>=4))){var c=q(ze);c&&(Le.style.visibility="hidden",Et=c[0],St=!1,yt=!0,xt=!1,wt=Ve+=1,Ze.push([wt,"moving widget"]))}if(yt){mt=0,document.body.style.cursor="default";var f=n-kt,h=i-At;(f||h)&&(kt=n,At=i,St||(St=!0,y()),ue.moveSceneWdgt(Et,f,h),f&&(Se.style.left=parseInt(Se.style.left)+f+"px"),h&&(Se.style.top=parseInt(Se.style.top)+h+"px"))}else document.body.style.cursor=t}else document.body.style.cursor=t}}function V(e){if(!s())if(ue.splitterMouseDn&&ue.splitterMouseDn()){Lt=!1,Ct=!1,We&&(We.style.display="none",We.children.length&&(We.children[0].style.display="none")),Le.style.visibility="hidden",It=!1,Ot=!1,Wt=!1,multiWdgtMoved_=!1,xt=!1,Dt=!1,yt=!1,St=!1,mt=0;var t=Ze.length;t&&Ze.splice(0,t)}else{if(Lt=!1,We)if(We.children.length<=1)We.style.display="none";else{if(Ct&&(Lt=!0,setTimeout(function(){Lt=!1},1e3),"ScenePage"==Je&&Fe)){for(var n,i=[Fe],o=1;n=We.children[o];o+=1){var r=n.getAttribute("keyid");r&&i.push(r)}if(i.length>1)if(2==i.length&&ue.getWidgetNode){var a=ue.frameInfo.rootName+"."+Fe+"."+i[1];setTimeout(function(){ue.getWidgetNode(a,"",function(e){e&&(We.style.display="none",X(e,!1,!1))})},300)}else H(null,null),K(i)}We.children[0].style.display="none",Le.style.visibility="hidden"}else;if(Ct=!1,It=!1,Wt=!1,Ot&&(Ot=!1,c(Ht),multiWdgtMoved_&&(Wt=!0,setTimeout(function(){Wt=!1},1e3),multiWdgtMoved_=!1,E(3e3,""))),xt=!1,Dt=!1,yt)yt=!1,c(wt),St&&Et&&(Dt=!0,setTimeout(function(){Dt=!1},1e3),St=!1,E(3e3,Et));else if(ze&&mt){bt=!0,setTimeout(function(){bt=!1},1e3);var l=e.clientX-Mt,d=e.clientY-Pt,p=!1;if(1!=mt&&3!=mt||0==l||(p=!0),2!=mt&&3!=mt||0==d||(p=!0),p&&ue.resizeWidget){var u=q(ze);if(u&&!R(u[2])){var f=u[0];y(),ue.resizeWidget(f,mt,l,d,function(e){e&&E(3e3,f)})}}}mt=0,setTimeout(function(){var e=Ze.length;e&&Ze.splice(0,e)},0)}}function Z(){function f(e,t,n,i,o,r,a){if(ue.copyWidget){var l=ze,s=!1;l&&l.parentNode&&(ze=null,s=!0),y(),ue.copyWidget(e,t,n,i,o,r,function(e,t){if(e){var n="";if(t)if(t.classList.contains("rewgt-scene")){var i=d(t);J(),i&&setTimeout(function(){P(i,!1,function(){var e=q(t);e&&(n=e[0]),X(t,!1,!1)})},0)}else if(t.parentNode.parentNode===ue&&"absolute"==t.style.position)J();else if(s){var o=q(t);o&&(n=o[0]),X(t,!1,!1)}E(600,n)}else s&&(ze=l);a&&a(e)})}}function h(e,t,n,o,r,a){function l(){var n=s.widget,i=s.name||"";if(Array.isArray(n)){"/"==i[0]&&(i=i.slice(1));var l=p(i);l?u(l,null):i="",y(),e&&(n=s.scene||n),ue.createWidget(n,i,t,o,r,a,function(e,t){e&&(t&&t.classList.contains("rewgt-scene")?(J(),"visible"!=ye.style.visibility&&ue.instantShow("create ScenePage successful.")):t&&t.parentNode.parentNode===ue&&t.getAttribute("data-temp.type")?J():X(t,!0,!1),E(300,""))})}}if(ue.createWidget){var s=n.option;if("object"!=typeof s){if(void 0===s&&n.dragUrl){var d=n.dragUrl+".json";i(d,function(e,t){if(e)ue.instantShow("error: read JSON failed ("+d+")."),console.log(e);else{try{s=JSON.parse(t)}catch(e){console.log(e),ue.instantShow("error: parse JSON failed ("+d+").")}s&&s.name&&l()}})}}else s.name&&l()}}function v(e){if(r(e.dataTransfer,"application/json"))e.preventDefault();else{if(!S)return;S!==Te&&S.parentNode!==Le||e.preventDefault()}}function m(e){e.stopPropagation(),e.preventDefault();var t=Ie.textContent;if(t){var n=!!e.shiftKey||e.target===nt,i=20-se-re,o=20-de-ae;if(r(e.dataTransfer,"application/json")){var a=null,l=e.dataTransfer.getData("application/json")||"{}";try{a=JSON.parse(l)}catch(e){console.log(e)}if(!a||"template"!=a.dragType&&"image"!=a.dragType)return;var s=!1;if("ScenePage"==Je&&Fe){var d=t.split(".");(3==d.length||!n&&4==d.length)&&(s=!0)}if("image"==a.dragType){var p=a.dragUrl,u=a.clientWidth,c=a.clientHeight;if(!p)return;0==p.indexOf(le)&&p.length>le.length&&(p=p.slice(le.length));var g={src:p},v=["Img",g,3];u&&c&&(g.style={width:u+"px",height:c+"px"}),s&&(v=[["P",{klass:"default-large-small hidden-visible-auto","data-group.optid":"rewgt/shadow-slide/steps"},2],v]),h(s,t,{option:{name:"Img",widget:v}},n,i,o)}else h(s,t,a,n,i,o),Te.style.display="none"}else if(S){var m=e.dataTransfer.getData("text/plain"),b=S.getAttribute("name");m&&t&&b&&("linker"==b&&ue.bindLinker?(y(),ue.bindLinker(m,t,function(e){e&&(Te.style.display="none",E(300,""))})):"copy"!=b&&"move"!=b||f(m,t,n,"move"==b,i,o,function(e){e&&(Te.style.display="none")}))}}}function b(){if(ze){var e=ze.parentNode;e&&(ze.classList.contains("rewgt-scene")?ue.resetRootShow?ue.resetRootShow(function(){Je="",Fe="",J()}):J():X(e,!1,!1)||ze.classList.contains("rewgt-panel")&&"absolute"!=ze.style.position&&J())}}function x(e){var t=null;if("ScenePage"==Je&&Fe&&"block"==We.style.display&&We.children.length>1){for(var n,i=[Fe],o=1;n=We.children[o];o+=1){var r=n.getAttribute("keyid");r&&i.push(r)}i.length>1&&(t=i)}else{if(!ze||!ze.parentNode)return;var a=q(ze);if(a){if(B(a[2])>=1)return void ue.instantShow("remove selected widget disallowed.");t=a[0]}}t&&function(e,t,n){if(ue.removeWidget&&(!n||confirm("do you want delete selected widget?"))){var i="";if("ScenePage"==Je&&t&&t.classList.contains("rewgt-scene"))for(var o,r=!1,a=0;o=we.children[a];a++){var l=o.getAttribute("keyid");if(l)if(l==Fe)r=!0;else if(i=l,r)break}y(),ue.removeWidget(e,function(e){e&&(J(),i&&setTimeout(function(){P(i,!1)},300),E(300,""))})}}(t,ze,e)}var A=0,S=null,I=null,W=null,D=null;if("/"!=(le=document.location.href.split("?")[0]).slice(-1)&&(le=le.slice(0,le.lastIndexOf("/")+1)),Ue=n(window.location.search.slice(1)).page||"index.html",ue=document.getElementById("react-container")){ue.frameInfo?(Object.assign(ue.frameInfo,{topHi:ee,rightWd:te,bottomHi:0,leftWd:ne}),setTimeout(function(){ue.refreshFrame&&ue.refreshFrame()},1e3)):ue.frameInfo={topHi:ee,rightWd:te,bottomHi:0,leftWd:ne,rootName:".body"},ue.classList.add("noselect-txt");var _=ue.getAttribute("__design__");if(_&&"0"!=_){ue.version=function(){return Q},ue.instantShow=function(t){if(t&&D){for(console.log("[MSG]",t);D.children.length>=5;){var n=D.children[0];D.removeChild(n)}var i=window.innerWidth,o=(window.innerHeight,0);i>800?(o=.2*i,i*=.6):i>400&&(o=.1*i,i*=.8),D.style.left=o+"px",D.style.width=i+"px";var r=document.createElement("p");r.setAttribute("style","width:"+(i-14)+"px; margin:2px; padding:6px; border:1px solid #ccc; background-color:#ffe; line-height:1.4; font-size:14px; color:#222; text-align:center; overflow:hidden; border-radius:3px; transition: all 0.4s ease-out; -o-transition: all 0.4s ease-out; -moz-transition: all 0.4s ease-out; -webkit-transition: all 0.4s ease-out; -ms-transition: all 0.4s ease-out;"),r.innerHTML=e(t),D.appendChild(r),D.style.display="block",setTimeout(function(){r&&r.parentNode&&(r.style.borderWidth="0px",r.style.margin="0px",r.style.padding="0px",r.style.height="0px")},1e4)}},L(),window.onbeforeunload=function(){return"This is single page application, do you want shift to another page?"},(fe=document.createElement("div")).setAttribute("style","position:absolute; left:0px; top:0px; width:100%; height:"+ee+"px; background:#e8e8e8 url("+ot.appBase()+"/res/ruler_top.png) no-repeat fixed "+(ne+se)+"px "+(ee-28)+"px; z-index:3006;"),document.body.appendChild(fe),(ce=document.createElement("div")).setAttribute("style","position:absolute; left:0px; top:0px; width:"+ne+"px; height:100%; background:#e8e8e8 url("+ot.appBase()+"/res/ruler_left.png) no-repeat fixed "+(ne-14)+"px "+(ee+de)+"px; z-index:3020;"),document.body.appendChild(ce),(he=document.createElement("div")).setAttribute("style","position:absolute; right:0px; top:0px; width:"+te+"px; height:100%; background-color:#e8e8e8; z-index:3020; overflow:hidden;"),document.body.appendChild(he);var j=document.createElement("div");j.setAttribute("style","position:relative; left:3px; top:3px; line-height:1.2; width:100%; height:"+ee+"px;"),ce.appendChild(j),(It=[["Main menu",ot.appBase()+"/res/menu.png","menu"],["Show pages/widgets",ot.appBase()+"/res/grid.png","thumb"]]).forEach(function(e){var t=e[0],n=e[1],i=e[2],o=document.createElement("img");o.setAttribute("style","width:22px; height:22px; border:1px solid #e8e8e8;"),o.setAttribute("src",n),o.setAttribute("title",t),o.setAttribute("name",i),j.appendChild(o)}),ce.addEventListener("mouseover",function(e){var t=e.target;"IMG"==t.nodeName&&(t.style.borderColor="#f8f8f8 #aaa #aaa #f8f8f8")},!1),ce.addEventListener("mouseout",function(e){var t=e.target;"IMG"==t.nodeName&&(t.style.borderColor="#e8e8e8")},!1);var R=document.createElement("div");R.setAttribute("style","position:relative; left:3px; top:0px; line-height:1.2; width:100%;"),ce.appendChild(R),(It=[["Switch viewport",ot.appBase()+"/res/switch.png","switch"],["Align center",ot.appBase()+"/res/align.png","align"],["","",""],["Remove widget",ot.appBase()+"/res/delete.png","delete"],["Undo",ot.appBase()+"/res/undo.png","undo"],["Redo",ot.appBase()+"/res/redo.png","redo"],["","",""],["Save",ot.appBase()+"/res/save.png","save"],["Open or create page",ot.appBase()+"/res/open.png","open"],["Config",ot.appBase()+"/res/config.png","config"]]).forEach(function(e){var t=e[0],n=e[1],i=e[2];if(n){var o="width:22px; height:22px; border:1px solid #e8e8e8;";!ot.useHtmlProxy||"open"!=i&&"config"!=i||(o+="display:none");var r=document.createElement("img");r.setAttribute("style",o),r.setAttribute("src",n),r.setAttribute("title",t),r.setAttribute("name",i),R.appendChild(r)}else{var a=document.createElement("div");a.setAttribute("style","width:100%; height:20px;"),R.appendChild(a)}}),ge=document.createElement("div");var U=ee+(ae-10)+de;ge.setAttribute("style","position:absolute; left:"+(ne-11)+"px; top:"+U+"px; width:9px; height:18px; border:1px solid #aaa; background-color:rgba(192,192,192,0.7); cursor:ns-resize;"),ge.setAttribute("title","Drag to move y-axis"),ce.appendChild(ge);var F=0,Z=!1,Me=!1,Ce=0;ge.addEventListener("click",a,!1),ge.addEventListener("mousedown",function(e){e.stopPropagation(),e.preventDefault(),Z=!0,Me=!1,F=e.clientY},!1),document.addEventListener("mousemove",function(e){var t=e.clientY;if(!(t<=20||t>=window.innerHeight-20)&&(!Me&&Z&&Math.abs(t-F)>=4&&(Ce=Ve+=1,Ze.push([Ce,"moving viewport"]),J(),Me=!0,Z=!1),Me)){e.stopPropagation(),e.preventDefault();var n=t-F;0!=n&&(F=t,de+=n,ue.style.top=de+"px",ge.style.top=ee+(ae-10)+de+"px",ce.style.backgroundPosition=ne-14+"px "+((0==ue.frameInfo.topHi?0:ee)+de)+"px")}},!1),document.addEventListener("mouseup",function(e){Z=!1,Me&&(c(Ce),Me=!1,e.stopPropagation(),e.preventDefault(),de+=e.clientY-F,L(),ue.style.top=de+"px",ge.style.top=ee+(ae-10)+de+"px",ce.style.backgroundPosition=ne-14+"px "+((0==ue.frameInfo.topHi?0:ee)+de)+"px",ue.frameInfo.bottomHi=de,ue.refreshFrame&&ue.refreshFrame())},!1),fe.innerHTML='<table style="width:100%; height:100%; border-collapse:collapse; margin:0px; padding:0px; border:0px solid gray; table-layout:auto; overflow:hidden"><tr><td style="width:'+ne+'px"></td><td style="vertical-align:top"></td><td style="width:'+te+'px"></td></tr></table>';var Re=fe.querySelectorAll("td")[1],qe=document.createElement("div");qe.setAttribute("style","width:100%; height:60px; margin:3px 0px 2px 0px; line-height:1.2; background-color:#f4f4f4; overflow-y:auto; border-radius:3px;"),Re.appendChild(qe);var et=document.createElement("div");et.setAttribute("style","width:100%; height:28px; overflow:hidden;"),Re.appendChild(et);var tt=document.createElement("div");tt.setAttribute("style","width:100%; height:20px;"),tt.setAttribute("title","Click to unselect widget"),Re.appendChild(tt),(Te=document.createElement("img")).setAttribute("draggable","true"),Te.setAttribute("style","display:none; position:relative; left:0px; top:3px; width:16px; height:16px; border:1px solid #e8e8e8; margin:0px 6px 0px 0px;"),Te.setAttribute("src",ot.appBase()+"/res/empty.png"),et.appendChild(Te),(Ne=document.createElement("span")).setAttribute("style","padding:2px 8px 2px 0px; color:#444;"),et.appendChild(Ne),(Ie=document.createElement("span")).setAttribute("style","padding:2px 10px 2px 0px; color:#444;"),et.appendChild(Ie);var nt=document.createElement("img");nt.setAttribute("style","display:none; position:relative; left:0px; top:2px; width:16px; height:16px;"),nt.setAttribute("src",ot.appBase()+"/res/insert.png"),et.appendChild(nt),ye=document.createElement("div");var at=window.innerWidth-ne-te;ye.setAttribute("style","visibility:hidden; position:absolute; left:"+ne+"px; top:0px; width:"+at+"px; height:"+(ee-10)+"px; background-color:#e8e8e8; overflow:hidden;"),fe.appendChild(ye),ye.innerHTML='<div name="prev_page" title="previous page" style="position:absolute; left:1px; top:2px; width:20px; height:102px; background:#ccc"></div><div name="prev_item" title="previous item" style="position:absolute; left:21px; top:2px; width:20px; height:102px; background:#ddd"></div><div name="page_div" style="position:absolute; left:40px; top:0px; width:'+(at-80)+'px; height:104px; z-index:3006; overflow:hidden"><div name="page_list" style="display:none; position:relative; left:0px, top:0px; width:20px; height:100%; overflow:hidden"></div></div><div name="page_mask" style="position:absolute; left:40px; top:0px; width:'+(at-80)+'px; height:104px; z-index:3006; overflow:hidden"></div><div name="page_tip" style="display:none; position:absolute; z-index:3040; background-color:#ffd; border:1px solid #ddd; font-size:12px; color:#222; line-height:1; padding:4px; box-shadow:0 3px 3px rgba(0,0,0,0.2)"></div><div name="next_item" title="next item" style="position:absolute; right:20px; top:2px; width:20px; height:102px; background:#ddd"></div><div name="next_page" title="next page" style="position:absolute; right:0px; top:2px; width:20px; height:102px; background:#ccc"></div>',be=ye.querySelector('div[name="page_div"]'),xe=ye.querySelector('div[name="page_mask"]'),we=ye.querySelector('div[name="page_list"]');var lt=ye.querySelector('div[name="page_tip"]');xe.addEventListener("mousedown",l,!1),xe.addEventListener("dragstart",l,!1),xe.addEventListener("dragend",l,!1),xe.addEventListener("dragover",function(e){if(S&&S.parentNode===Le){var t=S.getAttribute("name");"copy"!=t&&"move"!=t||e.preventDefault()}},!1),xe.addEventListener("drop",function(e){if(e.stopPropagation(),e.preventDefault(),S){var t=e.dataTransfer.getData("text/plain");if(t&&ue.getWidgetNode){var n=S.getAttribute("name");if("copy"==n||"move"==n){var i=Math.floor(Math.max(0,0-we.offsetLeft)/oe),o=xe.getBoundingClientRect(),r=Math.max(0,e.clientX-o.left),a=i+Math.floor(r/oe),l=we.children[a],s=null,d="",p=l?l.getAttribute("keyid")||"":"";a>0&&(s=we.children[a-1])&&(d=s.getAttribute("keyid")||""),ue.getWidgetNode(t,"",function(e){if(e&&e.classList.contains("rewgt-scene")){var t=q(e);if(t){var i=t[0],o=i.split("."),r=o.pop();if("move"==n&&(r==p||r==d))return;var a=!0,l=ue.frameInfo.rootName;p&&(a=!1,o.push(p),l=o.join(".")),f(i,l,a,"move"==n,0,0)}}})}}}},!1);var st=0,dt=!1;xe.addEventListener("click",function(t){t.stopPropagation(),t.preventDefault(),De.hideMenu();var n=Math.floor(Math.max(0,0-we.offsetLeft)/oe),i=xe.getBoundingClientRect(),o=Math.max(0,t.clientX-i.left),r=t.clientY,a=n+Math.floor(o/oe),l=we.children[a];if(l){var s=l.getAttribute("keyid")||"",d=l.getAttribute("name");(s=d?s+": "+d:s)&&(st&&(clearTimeout(st),st=0,lt.style.display="none"),setTimeout(function(){dt||(lt.style.left=o+40+2+"px",lt.style.top=Math.min(ee-36,r+20)+"px",lt.innerHTML=e(s),lt.style.display="block",st=setTimeout(function(){lt.style.display="none",st=0},3e3))},500))}},!1),xe.addEventListener("dblclick",function(e){e.stopPropagation(),e.preventDefault(),dt=!0,setTimeout(function(){dt=!1},1e3);var t=Math.floor(Math.max(0,0-we.offsetLeft)/oe),n=xe.getBoundingClientRect(),i=Math.max(0,e.clientX-n.left),o=t+Math.floor(i/oe),r=we.children[o];if(r){var a=r.getAttribute("keyid");a&&(J(),setTimeout(function(){P(a,!1),r.querySelector("canvas")&&setTimeout(function(){C(a)},600)},0))}},!1);for(var pt,ut=0;pt=ye.children[ut];ut++)0!=(pt.getAttribute("name")||"").indexOf("page_")&&(pt.addEventListener("mouseover",function(e){var t=e.target;"DIV"==t.nodeName&&(t.style.opacity="0.7")},!1),pt.addEventListener("mouseout",function(e){var t=e.target;"DIV"==t.nodeName&&(t.style.opacity="1")},!1),pt.addEventListener("click",function(e){e.stopPropagation();var t=Math.floor(be.clientWidth/oe);if(!(t<=0)){var n=Math.max(0,0-we.offsetLeft),i=Math.floor(n/oe),o=we.children.length,r=e.target.getAttribute("name");"prev_page"==r?i>=t?we.style.left=0-n+t*oe+"px":i>0&&(we.style.left="0px"):"next_page"==r?o>i+t&&(we.style.left=0-n-t*oe+"px"):"prev_item"==r?i>0&&(we.style.left=0-oe*(i-1)+"px"):"next_item"==r&&i+1<o&&(we.style.left=0-oe*(i+1)+"px")}},!1));Te.addEventListener("mouseover",function(e){var t=e.target;"IMG"==t.nodeName&&(t.style.borderColor="#f8f8f8 #aaa #aaa #f8f8f8")},!1),Te.addEventListener("mouseout",function(e){var t=e.target;"IMG"==t.nodeName&&(t.style.borderColor="#e8e8e8")},!1),Te.addEventListener("click",a,!1),Te.addEventListener("dblclick",function(e){e.stopPropagation(),Te.style.display="none"},!1),Te.addEventListener("dragstart",function(e){var t=Te.getAttribute("title");t&&(A=Ve+=1,Ze.push([A,"dragging widget"]),S=Te,e.dataTransfer.setData("text/plain",t))},!1),Te.addEventListener("dragend",function(e){S&&c(A),S=null,I.selectedInfo=null,I.style.display="none"},!1),Ne.addEventListener("click",a,!1),Ie.addEventListener("click",function(e){e.stopPropagation();var t=e.target;if("SPAN"==t.nodeName){var n=t.getAttribute("title"),i=t.getAttribute("path");n&&i&&ue.getWidgetNode&&ue.getWidgetNode(n,i,function(e){X(e,!1,!1)})}},!1),Ne.addEventListener("mousedown",a,!1),Ne.addEventListener("mousemove",a,!1),Ne.addEventListener("mouseup",a,!1),Ie.addEventListener("mousedown",a,!1),Ie.addEventListener("mousemove",a,!1),Ie.addEventListener("mouseup",a,!1);var ct=0;et.addEventListener("dragover",function(e){ct&&clearTimeout(ct);var t=S&&"linker"==S.getAttribute("name");ct=setTimeout(function(){Ie.style.backgroundColor="",nt.style.display="none",ct=0},1e3),Ie.style.backgroundColor="#f8f8f8",nt.style.display=t?"none":"inline"},!1),Ie.addEventListener("dragover",v,!1),Ie.addEventListener("drop",m,!1),nt.addEventListener("dragover",v,!1),nt.addEventListener("drop",m,!1),fe.setWidgetInfo=function(t){var n="";t&&t.forEach(function(t,i){var o=t[0],r=t[1],a=t[2],l=t[3];if(i>0&&(r="."+r),"Template"==o&&a)n+='<span style="color:blue">'+e(r)+"</span>";else if(l){var s=l[0],d=l[1];n+=s&&d?'<span title="'+e(s,!0)+'" path="'+e(d,!0)+'" style="color:blue; text-decoration:underline">'+e(r)+"</span>":e(r)}else n+=e(r)}),Ie.innerHTML=n,Ie.isSceneWdgt=t&&3==t.length&&"ScenePage"==t[1][0]};var ft=!0;fe.listChildren=function(t){var n="",i=["","#a00",-1,[],[]];ue.listChildren&&(i=ue.listChildren(t));var o=i[0],r=i[1],a=i[2],l=i[3],s=i[4];l.forEach(function(t,i){n+=i==a?'<button style="color:'+r+'">':"<button>",n+=e(t)+"</button>"}),qe.innerHTML=n,o=t?o.replace(/</g,"").replace(/>/g,""):"",Ne.setAttribute("wdgt_name",o),Ne.innerHTML=o?"<b>"+e(o)+"</b>:":"",t||ft||M(s,!1)},qe.addEventListener("click",function(e){var t=e.target;if("BUTTON"==t.nodeName){e.stopPropagation(),De.hideMenu();var n=t.textContent;if(n)if(ze){if(ue.getWidgetNode){var i=q(ze);if(i){var o=i[0],r=i[2];ue.getWidgetNode(n,o,function(e,t){if(e)if(t){var i=2==r.length&&"ScenePage"==r[1][0];Te.setAttribute("src",ot.appBase()+"/res/linker.png"),Te.setAttribute("name","linker"),Te.setAttribute("title",o+"."+n),Te.isSceneWdgt=i,Te.style.display="inline"}else X(e,!1,!0)})}}}else P(n,!0)}},!1),ve=document.createElement("div");var ht=ne+(re-10)+se;ve.setAttribute("style","position:absolute; left:"+ht+"px; top:"+(ee-11)+"px; width:18px; height:9px; border:1px solid #aaa; background-color:rgba(192,192,192,0.7); cursor:ew-resize;"),ve.setAttribute("title","Drag to move x-axis"),fe.appendChild(ve);var gt=0,vt=!1,xt=!1,wt=0;ve.addEventListener("click",a,!1),ve.addEventListener("mousedown",function(e){e.stopPropagation(),e.preventDefault(),vt=!0,xt=!1,gt=e.clientX},!1),document.addEventListener("mousemove",function(e){var t=e.clientX;if(!(t<=ne+20||t>=window.innerWidth-te-30)&&(!xt&&vt&&Math.abs(t-gt)>=4&&(wt=Ve+=1,Ze.push([wt,"moving viewport"]),J(),xt=!0,vt=!1),xt)){e.stopPropagation(),e.preventDefault();var n=t-gt;0!=n&&(gt=t,se+=n,ue.style.left=se+"px",fe.style.backgroundPosition=ne+se+"px "+(ee-28)+"px",T())}},!1),document.addEventListener("mouseup",function(e){if(vt=!1,xt){c(wt),xt=!1,e.stopPropagation(),e.preventDefault();var t=e.clientX;if(t<=ne+20||t>=window.innerWidth-te-30)return;var n=t-gt;0!=n&&(se+=n,ue.style.left=se+"px",fe.style.backgroundPosition=ne+se+"px "+(ee-28)+"px",T()),me.style.display=0==se?"block":"none"}},!1),me=document.createElement("div");var kt=pe?"left:"+(ne+pe-20+se)+"px":"left:"+(window.innerWidth-te-20)+"px";me.setAttribute("style","position:absolute; "+kt+"; top:"+(ee-11)+"px; width:18px; height:9px; border:1px solid #aaa; background-color:rgba(192,192,255,0.7); cursor:ew-resize;"),me.setAttribute("title","Drag to resize width"),fe.appendChild(me);var At=0,Et=!1,St=!1,Mt=0;me.addEventListener("click",a,!1),me.addEventListener("mousedown",function(e){e.stopPropagation(),e.preventDefault(),Ee.style.display="block",Et=!0,St=!1,At=e.clientX},!1),document.addEventListener("mousemove",function(e){var t=e.clientX;if(!(t<=ne+200||t>=window.innerWidth-te-20)&&(!St&&Et&&Math.abs(t-At)>=4&&(Mt=Ve+=1,Ze.push([Mt,"resizing viewport"]),J(),St=!0,Et=!1),St)){e.stopPropagation(),e.preventDefault();var n=t-At;0!=n&&(pe||(pe=window.innerWidth-ne-te),At=t,pe+=n,O())}},!1),document.addEventListener("mouseup",function(e){if(Et=!1,Ee.style.display="none",St){c(Mt),St=!1,e.stopPropagation(),e.preventDefault();var t=e.clientX;if(t<=ne+200||t>=window.innerWidth-te-20)return;var n=t-At;0!=n&&(pe||(pe=window.innerWidth-ne-te),pe+=n,O())}},!1),window.addEventListener("resize",O,!1),(ke=document.createElement("div")).setAttribute("style","position:relative; left:2%; top:0px; width:96%; height:60px; margin:4px 0px 0px 0px; line-height:1; background-color:#f4f4f4; overflow-y:auto; border-radius:3px;"),he.appendChild(ke),(Ae=document.createElement("div")).setAttribute("style","width:100%; height:"+(window.innerHeight-64)+"px;"),he.appendChild(Ae),(Ee=document.createElement("div")).setAttribute("style","display:none; position:absolute; left:0px; top:0px; width:100%; height:100%; z-index:3020;"),he.appendChild(Ee),ke.addEventListener("click",function(e){var t=e.target;"BUTTON"==t.nodeName&&(e.stopPropagation(),t.style.color||Ae.showPage(t.getAttribute("name")))},!1),Ae.addPage=function(e,t,n){for(var i,o=0;i=Ae.children[o];o++)if(i.getAttribute("name")==e)return;var r=document.createElement("button");r.setAttribute("name",e),r.textContent=n||e,ke.appendChild(r);var a=document.createElement("div");a.setAttribute("name",e),a.setAttribute("style","display:none; width:100%; height:100%;"),Ae.appendChild(a);var l=document.createElement("iframe");l.setAttribute("frameborder","no"),l.setAttribute("border","0"),l.setAttribute("style","border:0px solid #ccc; width:100%; height:100%;"),a.appendChild(l),l.setAttribute("src",t)},Ae.showPage=function(e){for(var t,n=0;t=Ae.children[n];n++)t.style.display=t.getAttribute("name")==e?"block":"none";for(var i,n=0;i=ke.children[n];n++)i.style.color=i.getAttribute("name")==e?"#a00":""},Ae.rmvPage=function(e){for(var t,n="",i=0;t=Ae.children[i];i++)if(t.getAttribute("name")==e){"none"!=t.style.display&&(i<Ae.children.length-1?n=Ae.children[i+1].getAttribute("name"):i>0&&(n=Ae.children[i-1].getAttribute("name"))),Ae.removeChild(t);for(var o,r=0;o=ke.children[r];r++)if(o.getAttribute("name")==e){ke.removeChild(o);break}break}n&&Ae.showPage(n)},Ae.setPropEditor=function(e,t,n,i){var o=Ae.querySelector('div[name="property"] > iframe');if(o&&o.contentWindow){var r=e&&t&&n?{method:"init",param:[e,t,n,i]}:{method:"clear",param:[]},a="[PROJECT_NAME]"+JSON.stringify(r);o.contentWindow.postMessage(a,"*")}},Ae.showPropEditor=function(e){var t=Ae.querySelector('div[name="property"] > iframe');if(t&&t.contentWindow){var n={method:"setVisible",param:[!!e]},i="[PROJECT_NAME]"+JSON.stringify(n);t.contentWindow.postMessage(i,"*")}};for(var Pt,Ct=[],Tt=!1,Nt=!1,It=document.querySelectorAll("meta"),ut=0;Pt=It[ut];ut+=1)if("pinp:template"==Pt.getAttribute("property")){var Ot=Pt.getAttribute("page"),Ht=Pt.getAttribute("content");"property"==Ot?Ht||(Tt=!0):"resource"==Ot?Ht||(Nt=!0):Ot&&Ht&&Ct.push([Ot,decodeURI(Ht)])}Ct.length>=20&&(ke.style.height="96px");var _t=t("./").pathname;"/"!=_t[0]&&(_t="/"+_t);var Bt=ot.appBase()+"/list_resource.html?base="+encodeURIComponent(_t),zt="";Tt||(zt="property",Ae.addPage("property",ot.appBase()+"/prop_page.html"));var jt="";if(ot.useHtmlProxy&&(ot.repoName&&(jt+="&repo="+encodeURIComponent(ot.repoName)),ot.accessToken&&(jt+="&token="+encodeURIComponent(ot.accessToken)),ot.accessUser&&(jt+="&user="+encodeURIComponent(ot.accessUser)),ot.accessSite&&(jt+="&site="+encodeURIComponent(ot.accessSite))),!Nt){zt||(zt="resource");var Rt=Bt+"&home=1";ot.resourceBase&&(Rt+="&url="+encodeURIComponent(ot.resourceBase)),ot.useHtmlProxy&&(Rt+="&upload=1"+jt),Ae.addPage("resource",Rt)}Ct.forEach(function(e){zt||(zt=e[0]);var t=Bt+"&url="+encodeURIComponent(e[1]+"")+jt;Ae.addPage(e[0]+"",t)}),i("$utils?cmd=get_config",function(e,t){if(!e)try{var n=JSON.parse(t);"object"==typeof n&&(Xe=n,(n.resourcePages||[]).forEach(function(e){zt||(zt=e[0]),Ae.addPage(e[0]+"",Bt+"&url="+encodeURIComponent(e[1]+"")+jt)}))}catch(e){}zt&&Ae.showPage(zt)}),window.addEventListener("message",function(e){try{"object"==typeof e&&e.data?(e=e.data,e=JSON.parse(e.slice(14))):e=null}catch(t){e=null,console.log(t)}if("object"==typeof e)if("warning"==e.method)ue.instantShow(e.param[0]+"");else if("onDialogLoad"==e.method){var t=Be.querySelector("iframe");if(!t||t.messengerOK)return;t.messengerOK=!0,t.initDialog&&t.initDialog()}else if("onDialogExit"==e.method){var n=e.param[0],i=e.param[1];n&&(Be.innerHTML="",ue.setDialogModal(!1),ue.setDesignModal(!1)),i&&(y(),ue.saveDesigner&&ue.saveDesigner(n,e.param[2],e.param[3]))}else if("saveProp"==e.method)try{if(ue.updateWdgtProp){var r=ze,a=!1;r&&r.parentNode&&(ze=null,a=!0);var l=e.param[0],s=e.param[1];(e.param[2]||[]).forEach(function(e){s[e]=void 0}),y(),ue.updateWdgtProp(l,s,function(e,t){if(e){if(t&&t.classList.contains("rewgt-scene")){var n=d(t);J(),n&&setTimeout(function(){P(n,!1,function(){X(t,!1,!1)})},0)}else a&&t&&X(t,!1,!1);E(300,"")}else a&&(ze=r)})}}catch(e){console.log(e)}else if("dragEnd"==e.method){var p=e.param[0];"template"!=p&&"image"!=p||(I.selectedInfo=null,I.style.display="none")}else if("saveConfigData"==e.method){var n=e.param[0],i=e.param[1],u=e.param[2];n&&(Be.innerHTML="",ue.setDialogModal(!1),ue.setDesignModal(!1)),i&&"object"==typeof u&&o("$utils?cmd=save_config",u,function(e,t){e?(ue.instantShow("error: save configure failed"+(t?" ("+t+").":".")),console.log(e)):ue.instantShow("save configure successful.")})}else"closeDialog"==e.method&&(Be.innerHTML="",ue.setDialogModal(!1),ue.setDesignModal(!1))},!1),(Pe=document.createElement("div")).setAttribute("style","display:none; position:absolute; z-index:3010; pointer-events:none; border:1px dashed blue;"),document.body.appendChild(Pe),(D=document.createElement("div")).setAttribute("style","display:none; position:absolute; left:0px; top:0px; z-index:6000;"),document.body.appendChild(D),(Se=document.createElement("div")).setAttribute("style","display:none; position:absolute; z-index:3010; pointer-events:none; border:1px dotted red;"),document.body.appendChild(Se);It=[["Drag to move, double click to relay",ot.appBase()+"/res/move.png","move",!0],["Drag to insert, double click to relay",ot.appBase()+"/res/copy.png","copy",!0],["Drag to link, double click to relay",ot.appBase()+"/res/linker.png","linker",!0],["Modify child styles",ot.appBase()+"/res/styles.png","styles",!1],["Edit text content",ot.appBase()+"/res/edit_txt.png","edit_txt",!1],["Select uplevel",ot.appBase()+"/res/goup.png","uplevel",!1],["Copy as linker",ot.appBase()+"/res/copy2.png","copy_lnk",!1],["Pop to top",ot.appBase()+"/res/up.png","up",!1],["Push to bottom",ot.appBase()+"/res/down.png","down",!1]];(Le=document.createElement("div")).setAttribute("name","float-btn"),Le.setAttribute("style","position:absolute; visibility:hidden; left:0px; top:-26px; width:"+(It.length*ie+2)+"px; height:22px; border:1px solid #ddd; background-color:#f0f0f0; overflow:hidden; pointer-events:auto;"),Se.appendChild(Le),It.forEach(function(e){var t=e[0],n=e[1],i=e[2],o=e[3],r=document.createElement("img");r.setAttribute("style","width:16px; height:16px; border:1px solid #f0f0f0; margin:2px;"),r.setAttribute("src",n),r.setAttribute("title",t),r.setAttribute("name",i),r.setAttribute("draggable",o?"true":"false"),Le.appendChild(r)}),Le.addEventListener("mousedown",function(e){e.stopPropagation(),"true"!=e.target.getAttribute("draggable")&&e.preventDefault()},!1),Le.addEventListener("mouseup",function(e){e.stopPropagation()},!1),Le.addEventListener("mouseover",function(e){var t=e.target;"IMG"==t.nodeName&&(t.style.borderColor="#fff #aaa #aaa #fff")},!1),Le.addEventListener("mouseout",function(e){var t=e.target;"IMG"==t.nodeName&&(t.style.borderColor="#f0f0f0")},!1),Le.addEventListener("click",function(e){function t(e){e&&E(1e3,o)}if(!s()){e.stopPropagation();var n=e.target,i="",o="",r=null;if("IMG"==n.nodeName){var a=n.getAttribute("name");if("up"!=a&&"down"!=a||!ue.setWdgtZIndex){if("uplevel"==a)b();else if("styles"==a&&ue.popDesigner){if(ze&&ze.parentNode&&(d=q(ze))){o=d[0],i=Ne.getAttribute("wdgt_name");l={name:"default",title:"styles editor",url:ot.appBase()+"/edit_styles.html",halfScreen:!1,clickable:!0,width:.8,height:.8,get:function(e){var t=e.props&&ue.widgetSchema(e,!1,!0);return t&&2==t.length?(r=t[1].wdgtOption||null,[r&&r.linkStyles||null,o,i]):[null,"",""]},set:function(e,t,n){function i(e,t){var n=o;if(a&&(ze=l),e){if(t){var i=q(t),r=i?i[0]:"";r&&r==o?X(t,!1,!1):n=""}E(300,n)}}var a=!1,l=ze,s=t[0],d=t[1];s&&r&&"object"==typeof d&&ue.saveCompStyles?(a=!0,ze=null,ue.saveCompStyles(e,r,d,i)):i(!1,null)}};ue.popDesigner(o,"default",l,"")}}else if("edit_txt"==a&&ue.popDesigner){if(ze&&ze.parentNode&&0==ze.children.length&&(d=q(ze))){o=d[0],i=Ne.getAttribute("wdgt_name");var l={name:"default",title:"text editor",url:ot.appBase()+"/edit_content.html",halfScreen:!0,clickable:!0,width:.8,height:.8,get:function(e){return[e.textContent,o,i]},set:function(e,t,n){function i(e,t){var n=o;if(r&&(ze=a),e){if(t){var i=q(t),l=i?i[0]:"";l&&l==o?X(t,!1,!1):n=""}E(300,n)}}var r=!1,a=ze,l=t[0],s=t[1];l&&"string"==typeof s&&ue.saveNodeContent?(r=!0,ze=null,ue.saveNodeContent(o,s,i)):i(!1,null)}};ue.popDesigner(ze,"default",l,"")}}else if("copy_lnk"==a&&ze&&ze.parentNode){var d=q(ze);d&&(Ge=2,Ke.value='<div $="'+d[0]+'"></div>',Ke.select(),document.execCommand("copy"),setTimeout(function(){Le.style.visibility="hidden"},0))}}else{var p=null;if(ze&&ze.parentNode&&(d=q(ze))){var u=d[2];3==u.length&&"ScenePage"==u[1][0]&&(o=d[0],p=u[1][2][2])}if(!p)return;for(var c,f=[],h=0,g=0,v=null,m=null,x=0,w=0,k=0;c=p.children[k];k++){var A=parseInt(c.style.zIndex)||0;A>=1e3&&(A-=2e3),0==k?(h=A,v=c,g=A,m=c):(A>=h&&(v=c,A>(h=A)&&(x=0),x+=1),A<=g&&(m=c,A<(g=A)&&(w=0),w+=1)),f.push([A,c])}if(0==f.length)return;if("up"==a){if(ze===v&&1==x)return;y(),ue.setWdgtZIndex(o,Math.min(999,h+1),t)}else{if(ze===m&&1==w)return;y(),ue.setWdgtZIndex(o,Math.max(-999,g-1),t)}}}}},!1),Le.addEventListener("dblclick",function(e){if(!s()){var t=e.target;if("IMG"==t.nodeName&&"true"==t.getAttribute("draggable")){e.stopPropagation();var n=t.getAttribute("src"),i=t.getAttribute("name");n&&(Te.setAttribute("src",n),i&&Te.setAttribute("name",i),Te.setAttribute("title",Ie.textContent),Te.isSceneWdgt=Ie.isSceneWdgt,Te.style.display="inline")}}},!1),Le.addEventListener("dragstart",function(e){if(!s()){var t=Ie.textContent,n=e.target;t&&"IMG"==n.nodeName&&"true"==n.getAttribute("draggable")&&(A=Ve+=1,Ze.push([A,"dragging widget"]),(S=n).isSceneWdgt=Ie.isSceneWdgt,e.dataTransfer.setData("text/plain",t))}},!1),Le.addEventListener("dragend",function(e){S&&c(A),S=null,I.selectedInfo=null,I.style.display="none"},!1),ce.addEventListener("click",function(e){e.stopPropagation(),De.hideMenu(),J()},!1),fe.addEventListener("click",function(e){e.stopPropagation(),De.hideMenu(),J()},!1),setInterval(function(){if(!yt)try{ze&&ze.parentNode?H(ze,null):ze&&J()}catch(e){}},250),document.addEventListener("mousedown",G,!1),document.addEventListener("mousemove",Y,!1),document.addEventListener("mouseup",V,!1),(I=document.createElement("div")).setAttribute("style","display:none; position:absolute; z-index:3010; pointer-events:none; border:1px solid red;"),document.body.appendChild(I);var qt=document.createElement("div");qt.setAttribute("style","position:absolute; left:0px; top:-24px; width:100px; height:22px; color:#a00;"),I.appendChild(qt),(W=document.createElement("img")).setAttribute("style","display:none; position:absolute; right:0px; bottom:0px; width:16px; height:16px;"),W.setAttribute("src",ot.appBase()+"/res/insert.png"),I.appendChild(W),Qe?g():setTimeout(function(){ue.instantShow("warning: undo/redo not supported, your browser has no local storage.")},0),(We=document.createElement("div")).setAttribute("style","display:none; position:absolute; left:0px; top:0px; z-index:3010; pointer-events:none;"),document.body.appendChild(We),(De=document.createElement("ul")).setAttribute("style","position:absolute; z-index:3022; display:none; left:30px; top:30px; min-width:60px; background-color:#f4f4f4; border:1px solid #eee; margin:0px; padding:2px; line-height:1.4; border-radius:4px; box-shadow:-2px 4px 4px rgba(0,0,0,0.2); list-style:none; -webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;-o-user-select:none"),De.innerHTML='<li name="list_prj" style="padding:0px 8px">List projects</li><li name="show_doc" style="padding:0px 8px">Online document</li>',document.body.appendChild(De),ot.useHtmlProxy&&(De.querySelector('li[name="list_prj"]').style.display="none"),De.addEventListener("mouseover",function(e){var t=e.target;"LI"==t.nodeName&&(t.style.backgroundColor="blue",t.style.color="white")},!1),De.addEventListener("mouseout",function(e){var t=e.target;"LI"==t.nodeName&&(t.style.backgroundColor="",t.style.color="")},!1),De.addEventListener("click",function(e){e.stopPropagation(),De.style.display="none";var t=e.target;if("LI"==t.nodeName){var n=t.getAttribute("name");if("list_prj"==n)i("$utils?cmd=list_project",function(e,t){if(e)ue.instantShow("warning: query project failed.");else try{var n,i,o=JSON.parse(t);if(Array.isArray(o)&&2==o.length&&Array.isArray(n=o[0])&&Array.isArray(i=o[1])){var r=n.length,a=n.concat(i),l={name:"default",title:"list project",url:ot.appBase()+"/list_projects.html",halfScreen:!0,width:.9,height:.9,clickable:!1};ue.showDesignDlg(0,l,a,"",r)}}catch(e){}});else if("show_doc"==n){var o={name:"default",title:"online help",url:ot.appBase()+"/doc/index.html",halfScreen:!1,width:.9,height:.9,clickable:!1};ue.showDesignDlg(0,o,{},"")}}},!1),De.showMenu=function(e,t){De.style.left=e+"px",De.style.top=t+"px",De.style.display="block"},De.hideMenu=function(){De.style.display="none"},(Oe=document.createElement("div")).setAttribute("style","position:absolute; z-index:3020; display:none; left:0px; top:0px; width:100%; height:100%"),fe.appendChild(Oe),(He=document.createElement("div")).setAttribute("style","position:absolute; z-index:3020; display:none; left:0px; top:0px; width:100%; height:100%"),ce.appendChild(He),(_e=document.createElement("div")).setAttribute("style","position:absolute; z-index:3020; display:none; left:0px; top:0px; width:100%; height:100%"),he.appendChild(_e),(Be=document.createElement("div")).isFull=!0,Be.setAttribute("style","position:absolute; z-index:3020; display:none; left:"+ne+"px; top:0px; width:"+(window.innerWidth-ne)+"px; height:100%; overflow:hidden"),document.body.appendChild(Be);var Ut=!1,Xt=!1,Jt=null,Ft=null,Kt=0,Gt=0;Be.onmouseup=_e.onmouseup=He.onmouseup=Oe.onmouseup=function(e){Xt||e.stopPropagation()},Be.addEventListener("mousemove",function(e){if(e.stopPropagation(),Ut&&Jt&&Jt.parentNode&&Ft&&Ft.parentNode){var t=e.clientX-Kt,n=e.clientY-Gt;Xt||(Math.abs(t)>=4||Math.abs(n>=4))&&(Xt=!0),!Xt||0==t&&0==n||(Jt.style.left=Jt.offsetLeft+t+"px",Jt.style.top=Jt.offsetTop+n+"px",Ft.style.left=Ft.offsetLeft+t+"px",Ft.style.top=Ft.offsetTop+n+"px",Kt+=t,Gt+=n)}},!1),document.addEventListener("mouseup",function(e){Ut=!1,Xt=!1,Jt&&Jt.parentNode&&(Jt.style.width="10px",Jt.style.height="10px")},!1),Be.ondblclick=_e.ondblclick=He.ondblclick=Oe.ondblclick=l,Be.onmousedown=_e.onmousedown=He.onmousedown=Oe.onmousedown=l,Be.onmousemove=_e.onmousemove=He.onmousemove=Oe.onmousemove=a,Be.onkeypress=_e.onkeypress=He.onkeypress=Oe.onkeypress=l,Be.onkeydown=_e.onkeydown=He.onkeydown=Oe.onkeydown=l,Be.onkeyup=_e.onkeyup=He.onkeyup=Oe.onkeyup=a,Be.ondragover=_e.ondragover=He.ondragover=Oe.ondragover=a,Be.ondrop=_e.ondrop=He.ondrop=Oe.ondrop=a,ue.selectedWidget=function(e){var t=ze;return e&&"string"==typeof e.nodeName&&(ze=e),t&&t.parentNode?t:null},ue.notifyBackup=function(e,t){E(t||300,e)},ue.showDesignDlg=function(e,t,n,i,o){var r=window.innerWidth-ne,a=window.innerHeight;t.halfScreen?(r-=ue.frameInfo.rightWd,Be.isFull=!1,Ae.showPropEditor(!1)):Be.isFull=!0,Be.style.width=r+"px",Be.innerHTML="";var l,s=t.url+"";l="/"==s[0]||0==s.indexOf("http")&&(":"==s[4]||"s:"==s.slice(4,6))?s:(i=i||"")&&"/"!=i.slice(-1)?i+"/"+s:i+s;var d,p=parseFloat(t.left),u=parseFloat(t.top),c=parseFloat(t.width);"number"!=typeof c||c>=.9999&&c<1||c<=0?(c="100%",d=0):c>=1?(d=Math.floor((r-c)/2),c+="px"):(d=Math.floor((1-c)/2*r),"number"==typeof p&&p>0&&p<1&&p<1-c&&(d=Math.floor(p*r)),c=100*c+"%");var f,h=parseFloat(t.height);"number"!=typeof h||h>=.9999&&h<1||h<=0?(h="100%",f=0):h>=1?(f=Math.floor((a-h)/2),h+="px"):(f=Math.floor((1-h)/2*a),"number"==typeof u&&u>0&&u<1&&u<1-h&&(f=Math.floor(u*a)),h=100*h+"%"),(Ft=document.createElement("iframe")).setAttribute("frameborder","no"),Ft.setAttribute("border","0"),Ft.setAttribute("style","position:absolute; border:0px solid #e0e0e0; left:0px; top:0px; width:100%; height:100%;"),Ft.style.left=d+"px",Ft.style.top=f+"px",Ft.style.width=c,Ft.style.height=h;var g=!0;"100%"!=c&&"100%"!=h&&(g=!1,Ft.style.borderWidth="1px",Ft.style.boxShadow="-2px 8px 4px rgba(0,0,0,0.1)"),Ft.messengerOK=!1,Ft.initDialog=function(){if(Ft.messengerOK&&ue.pluginCss)try{var t=[e,n,ue.pluginCss()];void 0!==o&&t.push(o);var i="[PROJECT_NAME]"+JSON.stringify({method:"init",param:t});Ft.contentWindow.postMessage(i,"*")}catch(e){console.log(e)}},Ft.exitDialog=function(){if(Ft.messengerOK){var e="[PROJECT_NAME]"+JSON.stringify({method:"close",param:[!0]});Ft.contentWindow.postMessage(e,"*")}else setTimeout(function(){Be.innerHTML="",ue.setDialogModal(!1),ue.setDesignModal(!1)},0)},Be.appendChild(Ft);var v=ot.useHtmlProxy?"$proxy.html":"$proxy";if(Ft.setAttribute("src",v+"?url="+encodeURIComponent(l)),!g&&!t.noMove){(Jt=document.createElement("div")).setAttribute("style","position:absolute; left:"+d+"px; top:"+f+"px; width:10px; height:10px;");var m=document.createElement("div");m.setAttribute("style","width:10px; height:10px; background-color:#00d; cursor:move;"),Jt.appendChild(m),Be.appendChild(Jt),m.onmousedown=function(e){e.stopPropagation(),e.preventDefault(),Jt&&Jt.parentNode&&(Ut=!0,Xt=!1,Jt.style.width="100%",Jt.style.height="100%",Kt=e.clientX,Gt=e.clientY)}}ue.setDialogModal(!0)},ue.setDesignModal=function(e){e||ue.closeModal(),ue.style.zIndex=e?"3012":"3000";var t=e?"block":"none";Oe.style.display=t,He.style.display=t,_e.style.display=t,e||Ae.showPropEditor(!0)},ue.setDialogModal=function(e){var t=e?"block":"none";e||(Oe.style.display="none",_e.style.display="none",ue.style.zIndex="3000"),He.style.display=t,Be.style.display=t},Be.onclick=_e.onclick=He.onclick=Oe.onclick=function(e){e.stopPropagation(),De.hideMenu();var t=e.target;setTimeout(function(){var e=!1,n=null,i=!0;if(t===He||t===Be)"none"!=Be.style.display&&(n=Be.querySelector("iframe"))&&n.exitDialog&&(e=!0),e||ue.setDialogModal(!1);else for(var o=t.parentNode;o;){if(o===He||o===Be){i=!1;break}if(o===document)break;o=o.parentNode}e?n.exitDialog():i&&ue.setDesignModal(!1)},300)};var $t=!0;ue.addEventListener("click",function(e){function t(){if($t){var e=m[0],t=m[1],n=m[2];H(t,n),fe.setWidgetInfo(n),fe.listChildren(e),I.style.display="none"}}if(!s()&&!(mt||bt||Lt||Wt||Dt||ue.splitterMouseDn&&ue.splitterMouseDn())){De.hideMenu();var n=e.target;if(e.shiftKey){var i=null,o="";if("ScenePage"==Je&&Fe){for(;n&&n!==ue;){var r=n.parentNode;if(r&&r.classList.contains("rewgt-center")){var a=r.parentNode;if(a&&a.classList.contains("rewgt-scene")){i=n;break}}n=r}i&&(o=d(i))}if(o){var l=!1;if("block"==We.style.display&&We.children.length>=1){for(var p=!1,u=1;h=We.children[u];u+=1)if(o===h.getAttribute("keyid")){We.removeChild(h),p=!0;break}if(p)We.children.length<=1?We.style.display="none":l=!0;else{c=i.getBoundingClientRect();(f=document.createElement("div")).setAttribute("keyid",o),f.setAttribute("style","position:absolute; border:1px dotted red; left:"+c.left+"px; top:"+c.top+"px; width:"+Math.max(0,c.width-2)+"px; height:"+Math.max(0,c.height-2)+"px;"),We.appendChild(f),l=!0}}else if(!ze||ze.classList.contains("rewgt-scene")){var c=i.getBoundingClientRect(),f=document.createElement("div");f.setAttribute("keyid",o),f.setAttribute("style","position:absolute; border:1px dotted red; left:"+c.left+"px; top:"+c.top+"px; width:"+Math.max(0,c.width-2)+"px; height:"+Math.max(0,c.height-2)+"px;"),We.appendChild(f),We.style.display="block",l=!0}if(l){je+=1;for(var h,g=[Fe],u=1;h=We.children[u];u+=1)(o=h.getAttribute("keyid"))&&g.push(o);g.length>1&&K(g)}}}else{var v=!1;if(ze&&ze.parentNode)for(;n&&n!==ue;){if(n===ze){v=!0;break}n=n.parentNode}We.style.display="none";var m=q(e.target);m&&($t=!0,v?setTimeout(function(){t()},300):t())}}},!1),ue.addEventListener("dblclick",function(e){if(!s()&&!mt&&!bt&&ze&&ze.parentNode&&ue.popDesigner){for(var t=e.target,n=!1;t&&t!==ue;){if(t===ze){n=!0;break}t=t.parentNode}if(n){var i=q(ze);if(i){$t=!1;var o=i[0],r=i[2],a=ze.getAttribute("data-group.optid"),l=B(r),d=0!=l||B(r,!0)>0;if(l<=1&&a&&a.indexOf("/")>0){var p=it[a];if(Array.isArray(p)){var u=p[2];if((p=p[1])&&(u&&ue.getGroupOpt&&(p=z(p,o)),f=p.find(function(e){return"default"===e.name}))){var c=Object.assign({},f);if(!c.get||!c.set){h=N(o,d);c.get=h[0],c.set=h[1]}return void ue.popDesigner(o,"default",c,c.baseUrl||"")}}}if(l<=1&&ue.popDesigner(o,"default"))return;if(l>=2)return;var f={name:"default",title:"default editor",url:ot.appBase()+"/edit_prop.html",halfScreen:!0,clickable:!1,width:.9,height:.9},h=N(o,d);f.get=h[0],f.set=h[1],ue.popDesigner(o,"default",f,"")}}}},!1),ue.addEventListener("dragover",function(t){if(!s()){var n,i=!!t.shiftKey,o=!1,a=!1;if(r(t.dataTransfer,"application/json"))n=!1,o=!0;else{if(!S)return;if(S!==Te&&S.parentNode!==Le)return;a="linker"==S.getAttribute("name"),n=S.isSceneWdgt}var l=[],d=q(t.target,l);if(d){var p=d[0],u=d[1],c=d[2],f=p.split(".").pop(),h=c.length>=2&&"ScenePage"==c[1][0],g=!1;if(h&&n&&!i){var v=c[1][2];if(p=v[1],a){if(!(l.length>=3))return;u=l[2],p=p+"."+(f=(c=c.slice(0,3))[2][1])}else l.length>=3?g=!0:(u=v[2],f=(c=c.slice(0,2))[1][1])}else h&&o&&!a&&l.length>=3&&(g=!0);if(g)for(var m=l.length-1;m>=2;){if(!(u=l[m]).getAttribute("data-is.ground")){for(f=(c=c.slice(0,m+1))[m][1],m-=1,p=f;m>=0;)p=c[m][1]+"."+p,m-=1;break}m-=1}var y=h&&3==c.length,b=h&&2==c.length,x=!1,w=u.getBoundingClientRect(),k=Math.min(0,w.top-ee);k<0&&(x=!0,w={left:w.left,top:ee,width:w.width,height:w.height+k}),I.selectedInfo=[p,u,c],I.style.left=w.left+"px",I.style.top=w.top+"px",I.style.width=Math.max(0,w.width-2)+"px",I.style.height=Math.max(0,w.height-2)+"px",I.style.borderColor=x?y?"transparent blue blue blue":"transparent red red red":y?"blue":"red",I.style.display="block",qt.innerHTML=e(f||""),!a&&w.width>=20&&w.height>=10&&!b?W.style.display="block":W.style.display="none",t.preventDefault()}else I.style.display="none",o&&t.preventDefault()}},!1),ue.addEventListener("drop",function(e){e.stopPropagation(),e.preventDefault();var t=!!e.shiftKey,n=e.clientX,i=e.clientY;if(!t&&"none"!=W.style.display){var o=W.getBoundingClientRect();n>=o.left&&n<o.left+o.width&&i>=o.top&&i<o.top+o.height&&(t=!0)}if(n=n-ne-se-re,i=i-ee-de-ae,r(e.dataTransfer,"application/json")){var a=null,l=e.dataTransfer.getData("application/json")||"{}";try{a=JSON.parse(l)}catch(e){console.log(e)}if(!a||"template"!=a.dragType&&"image"!=a.dragType)return;var s=(w="none"!=I.style.display&&I.selectedInfo)?w[0]:null;if("image"==a.dragType){var d=a.dragUrl,p=a.clientWidth,u=a.clientHeight;if(!d)return;0==d.indexOf(le)&&d.length>le.length&&(d=d.slice(le.length));v=!1;"ScenePage"==Je&&Fe&&((!s||s.split(".").length<=3)&&(s=ue.frameInfo.rootName+"."+Fe,t=!0),(3==(m=s.split(".")).length||!t&&4==m.length)&&(v=!0));var c={src:d},g=["Img",c,3];p&&u&&(c.style={width:p+"px",height:u+"px"}),v&&(g=[["P",{klass:"default-large-small hidden-visible-auto","data-group.optid":"rewgt/shadow-slide/steps"},2],g]),h(v,s,{option:{name:"Img",widget:g}},t,n,i)}else{var v=!1;if("ScenePage"==Je&&Fe&&s){var m=s.split(".");(3==m.length||!t&&4==m.length)&&(v=!0)}h(v,s,a,t,n,i)}}else if(S){var b=S.getAttribute("name"),x=e.dataTransfer.getData("text/plain"),w=I.selectedInfo;if(b&&x&&w){var k=w[0];w[1],w[2];"linker"==b&&ue.bindLinker?(y(),ue.bindLinker(x,k,function(e){e&&(Te.style.display="none",E(300,""))})):"copy"!=b&&"move"!=b||f(x,k,t,"move"==b,n,i,function(e){e&&(Te.style.display="none")})}}},!1),j.querySelector('img[name="menu"]').onclick=function(e){e.stopPropagation(),De.showMenu(e.clientX,e.clientY)},rt=function(){"none"==we.style.display?(ft&&(ft=!1,0==we.children.length&&ue.topmostNode&&ue.topmostNode()&&J()),ye.style.visibility="visible",we.style.display="block"):(we.style.display="none",ye.style.visibility="hidden")},j.querySelector('img[name="thumb"]').onclick=function(e){e.stopPropagation(),De.hideMenu(),rt()},R.querySelector('img[name="switch"]').onclick=function(e){e.stopPropagation(),De.hideMenu(),ue.frameInfo.topHi?(ue.frameInfo.topHi=0,ue.frameInfo.rightWd=0,ce.style.backgroundPosition=ne-14+"px "+de+"px",fe.style.display="none",he.style.display="none"):(ue.frameInfo.topHi=ee,ue.frameInfo.rightWd=te,ce.style.backgroundPosition=ne-14+"px "+(ee+de)+"px",fe.style.display="block",he.style.display="block"),O()},R.querySelector('img[name="align"]').onclick=function(e){e.stopPropagation(),De.hideMenu(),0==se&&0==de||(se=0,de=0,me.style.display="block",ue.style.left=se+"px",ue.style.top=de+"px",ce.style.backgroundPosition=ne-14+"px "+((0==ue.frameInfo.topHi?0:ee)+de)+"px",fe.style.backgroundPosition=ne+se+"px "+(ee-28)+"px",T(),ue.frameInfo.bottomHi=de,ue.refreshFrame&&ue.refreshFrame())},R.querySelector('img[name="delete"]').onmousedown=function(e){e.stopPropagation(),e.preventDefault(),De.hideMenu(),x(!0)},R.querySelector('img[name="undo"]').onclick=function(e){e.stopPropagation(),De.hideMenu(),w()},R.querySelector('img[name="redo"]').onclick=function(e){e.stopPropagation(),De.hideMenu(),k()},R.querySelector('img[name="save"]').onclick=function(e){function t(e,t){e?(ue.instantShow("error: save document failed"+(t?" ("+t+").":".")),console.log(e)):ue.instantShow("save document successful.")}if(e.stopPropagation(),De.hideMenu(),ue.getDocHtml){var n=ue.getDocHtml(ot.useHtmlProxy);if(n)if(ot.useHtmlProxy)ot.savePages(n,t);else{var i={page:Ue,html:n};o("$save?page="+encodeURIComponent(Ue),i,t)}else ue.instantShow("warning: dump document failed.")}},R.querySelector('img[name="open"]').onclick=function(e){e.stopPropagation(),De.hideMenu(),i("$utils?cmd=list_page",function(e,n){if(e)ue.instantShow("warning: query HTML file list failed.");else try{var i=JSON.parse(n);if(Array.isArray(i)){var o={name:"default",title:"open pages",url:ot.appBase()+"/list_pages.html",halfScreen:!0,width:.9,height:.9,clickable:!1},r=t("./").href;ue.showDesignDlg(0,o,{currProj:r,currFile:Ue,pages:i},"")}}catch(e){}})},R.querySelector('img[name="config"]').onclick=function(e){e.stopPropagation(),De.hideMenu();var t={name:"default",title:"edit configure",url:ot.appBase()+"/edit_config.html",halfScreen:!1,width:.8,height:.9,clickable:!1};ue.showDesignDlg(0,t,Xe,"")};var Yt=null,Vt="";(Ke=document.createElement("textarea")).setAttribute("style","position:absolute; left:0px; top:0px; width:24px; height:24px; overflow:hidden"),document.body.appendChild(Ke),Ke.addEventListener("copy",function(e){Yt=null;var t=2==Ge&&Ke.value;t&&Ye==je?setTimeout(function(){ue.instantShow("copy successful, wait to paste...")},0):(e.preventDefault(),t&&Ye!=je&&ue.instantShow("copy selected widget failed."))},!1),Ke.addEventListener("paste",function(e){var t=Yt;Yt=null,e.preventDefault();for(var n,i=e.clipboardData.types,o="",r=0;n=i[r];r+=1)if("Text"==n||0==n.indexOf("text/")){o=e.clipboardData.getData(n);break}var a="";if(o)if(!ze&&"ScenePage"==Je&&Fe)a=ue.frameInfo.rootName+"."+Fe;else if(o&&ze&&ze.parentNode){var l=q(ze);l&&(a=l[0])}a&&ue.pasteWidget&&(t&&(o!==Vt&&(t=null),Vt=""),y(),ue.pasteWidget(a,o,t,function(e,t,n){e&&(ue.instantShow(e+" widget(s) pasted."),t&&J(),n&&setTimeout(function(){X(n,!1,!1)},300),E(300,""))}))},!1),Ke.addEventListener("cut",function(e){var t=2==Ge&&Ke.value;if(Ye!=je)return e.preventDefault(),void(t&&ue.instantShow("cut selected widget failed."));if(t&&"string"==typeof $e){var n=q($e);if(n&&B(n[2])>=1)return e.preventDefault(),void ue.instantShow("cut selected widget disallowed.")}t&&(Yt=$e,Vt=Ke.value,setTimeout(function(){ue.instantShow("cut successful, wait to paste...")},0))},!1),Ke.addEventListener("keydown",function(e){var t=e.keyCode;if(!e.ctrlKey&&!e.metaKey||67!=t&&86!=t&&88!=t)if(e.preventDefault(),e.shiftKey){if(37==t)b();else if(39==t){if(ze&&ze.parentNode&&ue.firstChildOf&&(i=q(ze))){var n=ue.firstChildOf(i[0],!0);n&&X(n,!1,!1)}}else if(38==t||40==t){var i;if(ze&&ze.parentNode&&"ScenePage"==Je&&Fe&&ue.listPageChild&&(i=q(ze))){var o=i[2],r=o.length>=3?o[2][1]:"";if((i=ue.listPageChild(Fe)).length){bSort=[],i.forEach(function(e){var t=e[1],n=t.getBoundingClientRect();0==n.width&&0==n.height||bSort.push([n.top,n.left,e[0],t])}),bSort.sort(function(e,t){return e[0]==t[0]?e[1]-t[1]:e[0]-t[0]});var a=null;if(r)for(var l,s=0;l=bSort[s];s+=1)if(l[2]==r){a=38==t?s>0?bSort[s-1][3]:l[3]:s<bSort.length-1?bSort[s+1][3]:l[3];break}a||(a=38==t?bSort[0][3]:bSort[bSort.length-1][3]),X(a,!1,!1)}}}}else if(e.altKey)if(8==t)x(!1);else{var d=0,p=0;if(37==t?d=-1:38==t?p=-1:39==t?d=1:40==t&&(p=1),(d||p)&&"ScenePage"==Je&&Fe)if("block"==We.style.display&&We.children.length>1)$(Fe,d,p);else if(ze&&ze.parentNode&&(i=q(ze))){var u=i[0];y(),1==(i=ue.moveSceneWdgt(u,d,p)).length&&(d&&(Se.style.left=parseFloat(Se.style.left)+d+"px"),p&&(Se.style.top=parseFloat(Se.style.top)+p+"px"),E(3e3,u))}}},!1)}}}var Q="0.0.2",ee=116,te=220,ne=40,ie=22,oe=136,re=450,ae=350,le="",se=0,de=0,pe=0,ue=null,ce=null,fe=null,he=null,ge=null,ve=null,me=null,ye=null,be=null,xe=null,we=null,ke=null,Ae=null,Ee=null,Se=null,Me={left:0,top:0,width:0,height:0},Pe=null,Ce={left:0,top:0,width:0,height:0},Le=null,Te=null,Ne=null,Ie=null,We=null,De=null,Oe=null,He=null,_e=null,Be=null,ze=null,je=0,Re=!1,qe=!1,Ue="",Xe={},Je="",Fe="",Ke=null,Ge=0,$e=null,Ye=0,Ve=0,Ze=[],Qe=!!window.localStorage,et=(new Date).valueOf()-1e3,tt=0,nt=0,it={},ot=null,rt=null,at=function(e){return""},lt=!1,st=0,dt=0,pt=0,ut=0,ct=[],ft=[],ht=[],gt=0,vt=0,mt=0,yt=!1,bt=!1,xt=!1,wt=0,kt=0,At=0,Et="",St=!1,Mt=0,Pt=0,Ct=!1,Lt=!1,Tt=0,Nt=0,It=!1,Wt=!1,Dt=!1,Ot=!1,Ht=0,_t=0,Bt=0;setTimeout(function(){function e(n){n&&((t+=1)>180?setTimeout(function(){n(!1)},0):setTimeout(function(){window.W&&W.$main&&W.$main.inRunning?n(!0):e(n)},500))}var t=0;e(function(e){function t(e){P(e,!1),setTimeout(function(){rt()},2e3)}if(e&&"object"==typeof W&&W.$creator){var n=document.createElement("style");if(n.innerHTML="@-moz-document url-prefix(){button{padding:0px;}}",document.head.appendChild(n),ot=W.$creator,Z(),W.$main&&(W.$main.inDesign=!0,ue.keyOfNode&&(at=ue.keyOfNode)),ue.onlyScenePage&&ue.onlyScenePage()){var i=ue.topmostNode();if(!i)return;for(var o,r=0;o=i.children[r];r++)if(o.classList.contains("rewgt-scene")){var a=d(o);return void(a&&setTimeout(function(){t(a)},800))}}}else alert("load shadow-widget system failed!")})},800)}();